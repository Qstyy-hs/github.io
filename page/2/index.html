<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    
    <title>Kmoon</title>

    <meta name="description" content="Kmoon">
    <meta name="keywords" content="">

    



    <meta property="og:type" content="website"/>
    <meta property="og:title" content=""/>
    <meta property="og:description" content=""/>
    <meta property="og:locale" content="cn" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://www.kmoon.fun/page/2/index.html" />
    <meta property="og:site_name" content="Kmoon" />
    <meta property="article:publisher" content="" />
    <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "WebPage",
            "name": "",
            "description": "",
            "publisher": {
                "@type": "Organization",
                "name": "Kmoon"
            },
        }
    </script>


    

    
    <meta property="algolia:search" data-application-id="applicationID" data-api-key="apiKey" data-index-name="...">
    

    

    

    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🌙</text></svg>">
    

    

    

    
<link rel="stylesheet" href="/dist/build.css?v=1654266144177.css">


    
<link rel="stylesheet" href="/dist/custom.css?v=1654266144177.css">


    <script>
        window.isPost = false
        window.aomori = {
            
            
            valine: {
                enable: true,
                appId: "jEGcWPtFOBkynV3AUJIKLr8T-gzGzoHsz",
                appKey: "PM600NTeCMYW8HIwM4j0YzAM",
                placeholder: "Hello World!",
                avatar: "",
                pageSize: "10",
                lang: "zh-CN",
                visitor: false,
                highlight: false,
                recordIP: false,
                emojiCDN: "",
                enableQQ: false,
                requiredFields: []
            },
            
            
        }
        window.aomori_logo_typed_animated = true
        window.aomori_search_algolia = true

    </script>

<meta name="generator" content="Hexo 6.2.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="Kmoon" type="application/atom+xml">
</head>

<body>

    <div class="container">
    <header class="header">
        <div class="header-type">
            
            <div class="header-type-avatar avatar avatar-sm">
                <img src="/img/avatar.png" alt="Kmoon">
            </div>
            
            <div class="header-type-inner">
                
                    <div id="typed-strings" style="display:none">
                        <p>Kmoon</p>
                    </div>
                    <a class="header-type-title" id="typed" href="/"></a>
                
    
                
            </div>
        </div>
        <div class="header-menu">
            <div class="header-menu-inner">
                
                <a href="/">主页</a>
                
                <a href="/archives">归档</a>
                
                <a href="/categories">分类</a>
                
                <a href="/tags">标签</a>
                
                <a href="/friends">友链</a>
                
                <a href="/about">关于</a>
                
            </div>
            <div class="header-menu-social">
                
    <a class="social" target="_blank" href="">
        <ion-icon name=""></ion-icon>
    </a>

    <a class="social" target="_blank" href="">
        <ion-icon name=""></ion-icon>
    </a>

            </div>
        </div>

        <div class="header-menu-mobile">
            <div class="header-menu-mobile-inner" id="mobile-menu-open">
                <i class="icon icon-menu"></i>
            </div>
        </div>
    </header>

    <div class="header-menu-mobile-menu">
        <div class="header-menu-mobile-menu-bg"></div>
        <div class="header-menu-mobile-menu-wrap">
            <div class="header-menu-mobile-menu-inner">
                <div class="header-menu-mobile-menu-close" id="mobile-menu-close">
                    <i class="icon icon-cross"></i>
                </div>
                <div class="header-menu-mobile-menu-list">
                    
                    <a href="/">主页</a>
                    
                    <a href="/archives">归档</a>
                    
                    <a href="/categories">分类</a>
                    
                    <a href="/tags">标签</a>
                    
                    <a href="/friends">友链</a>
                    
                    <a href="/about">关于</a>
                    
                </div>
            </div>
        </div>
    </div>

</div>

    <div class="container">
        <div class="main">
            <section class="inner">
                <section class="inner-main">
                    <div class="index">
  
    
      <article
id="post-渗透测试——Nmap"
class="article article-type-post"
>



<div class="article-inner">
    
    <div class="article-feature">
        <a href="/2022/nmap/">
            <img
                src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 3 2'%3E%3C/svg%3E"
                data-src="https://s2.loli.net/2022/10/15/z5mAqI6e1QONYJD.png"
                alt="item.title"
                class="lazy"
            />
        </a>
    </div>
    

    <div class="article-body">
    <header class="article-title">
        <a href="/2022/nmap/">渗透工具——Nmap</a>
    </header>
    <div class="article-entry post-inner-html">
        
        <p>Nmap</p>
<p>2022年7月16日</p>
<ul>
<li><ul>
<li><p><strong>Nmap简介</strong></p>
</li>
<li><p><strong>常用命令</strong> </p>
</li>
<li><p>常用扫描类型</p>
<ul>
<li><strong>基本扫描</strong> </li>
<li><strong>隐蔽扫描</strong> </li>
<li><strong>SYN扫描</strong> </li>
<li><strong>NULL扫描</strong> </li>
<li><strong>ACK扫描</strong> </li>
<li>空闲扫描<ul>
<li><strong>寻找僵尸主机</strong> </li>
<li><strong>idle扫描应用</strong></li>
</ul>
</li>
<li><strong>常用命令组合</strong></li>
</ul>
</li>
<li><p><strong>NSE脚本引擎</strong> </p>
</li>
<li><p><strong>版本侦测用法</strong> </p>
</li>
<li><p>OS</p>
<p>侦测</p>
<ul>
<li><strong>OS侦测原理</strong> </li>
<li><strong>操作指令：</strong></li>
</ul>
</li>
<li><p><strong>输出格式</strong></p>
</li>
</ul>
</li>
<li><p><strong>Nmap简介</strong></p>
</li>
<li><p>Nmap是一款网络扫描和主机检测的非常有用的工具。可以用于收集信息和枚举，同时可以用来作为一个漏洞探测器或安全扫描器。</p>
</li>
<li><p>主要功能有：</p>
</li>
<li><ol>
<li>检测活在网络上的主机（主机发现） </li>
<li>检测主机上开放的端口（端口发现或枚举） </li>
<li>检测到相应的端口（服务发现）的软件和版本 </li>
<li>检测操作系统，硬件地址，以及软件版本 </li>
<li>检测脆弱性的漏洞（Nmap的脚本）</li>
</ol>
</li>
<li><ul>
<li>下载地址：<a href="https://nmap.org/download.html">https://nmap.org/download.html</a> </li>
<li>环境：Windows、Linux、Mac OS</li>
</ul>
</li>
<li><p><strong>常用命令</strong></p>
</li>
<li><p>-A  ：综合性扫描</p>
</li>
<li><p>-T4： 指定扫描过程使用的时序，总有6个级别（0-5），级别越高，扫描速度越快，但也容易被防火墙或IDS检测并屏蔽掉，在网络通讯状况较好的情况下推荐使用T4</p>
</li>
<li><p>-O :  指定Nmap进行系统版本扫描</p>
</li>
<li><p>-sV:  指定让Nmap进行服务版本扫描</p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token list punctuation">-</span> -p  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>port</span> <span class="token attr-name">ranges</span><span class="token punctuation">&gt;</span></span>: 扫描指定的端口
<span class="token list punctuation">-</span> -script <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">name</span><span class="token punctuation">&gt;</span></span> : 指定扫描脚本<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>-Pn  ： 不进行ping扫描</p>
</li>
<li><p>-iL  1.txt : 批量扫描1.txt中的目标地址</p>
</li>
<li><p>-PO :  使用IP协议包探测对方主机是否开启</p>
</li>
<li><p>-PE/PP/PM : 使用ICMP echo、 ICMP timestamp、ICMP netmask 请求包发现主机</p>
</li>
<li><p>-PS/PA/PU/PY : 使用TCP SYN/TCP ACK或SCTP INIT/ECHO方式进行发现</p>
</li>
<li><p>-e  eth0：指定使用eth0网卡进行探测</p>
</li>
<li><p>-f :  —mtu <val>: 指定使用分片、指定数据包的 MTU.</val></p>
</li>
<li><p>-b  <ftp relay="" host="">: 使用FTP bounce scan扫描方式</ftp></p>
</li>
<li><p>-g： 指定发送的端口号</p>
</li>
<li><p>-r:  不进行端口随机打乱的操作（如无该参数，nmap会将要扫描的端口以随机顺序方式扫描，以让nmap的扫描不易被对方防火墙检测到）</p>
</li>
<li><p>-v  表示显示冗余信息，在扫描过程中显示扫描的细节，从而让用户了解当前的扫描状态</p>
</li>
<li><p>-n :  表示不进行DNS解析；</p>
</li>
<li><p>-D  &lt;decoy1,decoy2[,ME],…&gt;: 用一组 IP 地址掩盖真实地址，其中 ME 填入自己的 IP 地址</p>
</li>
<li><p>-R  ：表示总是进行DNS解析。</p>
</li>
<li><p>-F :  快速模式，仅扫描TOP 100的端口</p>
</li>
<li><p>-S  <ip_address>: 伪装成其他 IP 地址</ip_address></p>
</li>
<li><p>—ttl  <val>: 设置 time-to-live 时间</val></p>
</li>
<li><p>—badsum: 使用错误的 checksum 来发送数据包（正常情况下，该类数据包被抛弃，如果收到回复，说明回复来自防火墙或 IDS/IPS）</p>
</li>
<li><p>—dns-servers : 指定DNS服务器</p>
</li>
<li><p>—system-dns : 指定使用系统的DNS服务器</p>
</li>
<li><p>—traceroute : 追踪每个路由节点</p>
</li>
<li><p>—scanflags <flags>: 定制TCP包的flags</flags></p>
</li>
<li><p>—top-ports <number> :扫描开放概率最高的number个端口</number></p>
</li>
<li><p>—port-ratio <ratio>: 扫描指定频率以上的端口。与上述—top-ports类似，这里以概率作为参数</ratio></p>
</li>
<li><p>—version-trace: 显示出详细的版本侦测过程信息</p>
</li>
<li><p>—osscan-limit: 限制Nmap只对确定的主机的进行OS探测（至少需确知该主机分别有一个open和closed的端口）</p>
</li>
<li><p>—osscan-guess: 大胆猜测对方的主机的系统类型。由此准确性会下降不少，但会尽可能多为用户提供潜在的操作系统</p>
</li>
<li><p>—data-length <num>: 填充随机数据让数据包长度达到 Num</num></p>
</li>
<li><p>—ip-options <options>: 使用指定的 IP 选项来发送数据包</options></p>
</li>
<li><p>—spoof-mac &lt;mac address/prefix/vendor name&gt; :  伪装 MAC 地址</p>
</li>
<li><p>—version-intensity <level>: 指定版本侦测强度（0-9），默认为7。数值越高，探测出的服务越准确，但是运行时间会比较长。</level></p>
</li>
<li><p>—version-light: 指定使用轻量侦测方式 (intensity 2)</p>
</li>
<li><p>—version-all: 尝试使用所有的probes进行侦测 (intensity 9)</p>
</li>
<li><p>—version-trace: 显示出详细的版本侦测过程信息</p>
</li>
<li><p><strong>常用扫描类型</strong></p>
</li>
<li><p>-sn :  只进行主机发现，不进行端口扫描</p>
</li>
<li><p>-sL:  List Scan 列表扫描，仅将指定的目标的IP列举出来，不进行主机发现</p>
</li>
<li><p>-sY/sZ: 使用SCTP INIT/COOKIE-ECHO来扫描SCTP协议端口的开放的情况</p>
</li>
<li><p>-sO:  使用IP protocol 扫描确定目标机支持的协议类型</p>
</li>
<li><p>-sN/sF/sX: 指定使用TCP Null, FIN, and Xmas scans秘密扫描方式来协助探测对方的TCP端口状态</p>
</li>
<li><p>-sS/sT/sA/sW/sM:指定使用 TCP SYN/Connect()/ACK/Window/Maimon  scans的方式来对目标主机进行扫描</p>
</li>
<li><p>-sU:  指定使用UDP扫描方式确定目标主机的UDP端口状况</p>
</li>
<li><p>-sP:  Ping扫描 快速发现网络</p>
</li>
<li><p>-sR： PRC扫描 定位PRC，对成功扫描的机器记录</p>
</li>
<li><p>-sI:  闲置扫描 僵尸主机扫描，非常隐蔽</p>
</li>
<li><p><strong>基本扫描</strong></p>
</li>
<li><p>我们先尝试扫描一下社区，只进行简单的扫描，确定社区开放了哪些端口，使用-A进行扫描</p>
</li>
<li><p>nmap -A  bbs.zkaq.cn</p>
</li>
<li><p><img src="/Nmap.files/image001.png" alt="img"></p>
</li>
<li><p>可以发现，社区开放了TCP的80端口，以及443端口。</p>
</li>
<li><p><strong>隐蔽扫描</strong></p>
</li>
<li><p>网络扫描的过程包括发送特殊够早的数据包给目标主机和对返回的结果进行基于某种标准的检查。从扫描结果中，我们可以知道那些主机在线，运行了哪些服务以及这些服务的版本信息等。</p>
</li>
<li><p>在一个安全的网络中，我们有可能根据需要来对抗IDS的异常行为捕捉。发送数据包的数量和速度，流量是否异常等，防火墙一般都会标记。为减少被检测到的概率，我们可以采取一些措施。</p>
</li>
<li><p>控制时间。</p>
</li>
<li><p>nmap控制扫描时间选项： </p>
</li>
<li></li>
<li><ol>
<li>-T（0~5）：  控制扫描进度，避免被检测的最简单形式。0是最温和的，5是最激进的，只能在局域网中使用。 </li>
<li>–max_hostgroup：  将扫描的主机数量限制在每次一个。 </li>
<li>–max_retries：  一般不需要修改此选项，如果是紧急情况且不在意扫描过程中可能错过一个包含潜在漏洞的主机，可以将这个选项设为0. </li>
<li>max_parallelism 10： 一次仅允许10个探测请求。 </li>
<li>scan_delay 两次探测之间停顿。</li>
</ol>
</li>
<li><p><strong>SYN****扫描</strong></p>
</li>
<li><p>使用-sS选项对我们的社区发起一个完全开发的扫描。结果如下：</p>
</li>
<li><p><img src="/Nmap.files/image002.png" alt="img"></p>
</li>
<li><p>从结果来看，社区仍然只开放两个端口，我们实战时要确保使用不同类型的扫描对目标网络扫描，否则可能错失一些重要信息。</p>
</li>
<li><p><strong>NULL****扫描</strong></p>
</li>
<li><p>使用NULL扫描，对社区进行扫描，再来看看结果：</p>
</li>
<li><p><img src="/Nmap.files/image003.png" alt="img"></p>
</li>
<li><p>很遗憾，没有得到有效信息，我们可以猜测社区应该是安装了防火墙。</p>
</li>
<li><p><strong>ACK****扫描</strong></p>
</li>
<li><p>在有防火墙的情况下，如果没从NULL扫描获取到什么信息的话，现在进行ACK扫描</p>
</li>
<li><p><img src="/Nmap.files/image004.png" alt="img"></p>
</li>
<li><p>很遗憾，仍然没有扫描到什么有效信息。看来社区防护还是做得很不错。</p>
</li>
<li><p><strong>空闲扫描</strong></p>
</li>
<li><p>为了降低被检测到的机率，我们通常需要转嫁责任，这时可以使用空闲扫描（idle scan），让一个僵尸主机承担扫描任务。</p>
</li>
<li></li>
<li><ol>
<li>nmap.org官网上详细讲述了空闲扫描的原理，可以在<a href="http://nmap.org/book/idlescan.html">http://nmap.org/book/idlescan.html</a>  了解空闲扫描的所有信息。</li>
</ol>
</li>
<li><p>使用空闲扫描（-sI）需要注意一个问题，就是要找一台TCP序列预测成功率高的僵尸主机，这个僵尸主机必须尽可能的空闲，比如说网络打印机就是一个很好地选择，因为网络打印机不仅存在着恒定的网络资源，而且很难预测它们的TCP序列。</p>
</li>
<li><p>空闲扫描的原理： </p>
</li>
<li></li>
<li><ol>
<li>向僵尸主机放松SYN/ACK数据包，获得带有分片ID（IPID）的RST报文。 </li>
<li>发送使用僵尸主机IP地址的伪数据包给目标主机。 </li>
<li>如果目标主机端口关闭，就会向僵尸主机响应RST报文。如果目标端口开放，目标主机向僵尸主机响应SYN/ACK报文，僵尸主机发现这个非法连接响应，并向目标主机发送RST报文，此时IPID号开始增长。 </li>
<li>通过向僵尸主机发送另一个SYN/ACK报文已退出上述循环并检查将是主机RST报文中的IPID是否每次增长2，同时目标主机的RST每次增长1。 </li>
<li>重复上述步骤直到检测完所有的端口。</li>
</ol>
</li>
<li><p><strong>寻找僵尸主机</strong></p>
</li>
<li><p>空闲扫描的第一步就是寻找僵尸主机，我们可以通过下面这条命令（-v 详细信息，-O 系统检测，-Pn 无ping，-n 无域名解析）来获得主机的TCP序列预测率。</p>
</li>
<li><p># nmap -v -O -Pn  -n <em><strong>.</strong></em>.<em><strong>.</strong></em></p>
</li>
<li><p><strong>idle****扫描应用</strong></p>
</li>
<li><p>使用以下命令扫描，并启动wireshark抓包。</p>
</li>
<li><p>#  nmap -p 22,23,53,80,443,8888,3960 -Pn -sI <em><strong>.</strong></em>.<em><strong>.</strong></em>(僵尸主机IP） <em><strong>.</strong></em>.<em><strong>.</strong></em>(目标主机IP)</p>
</li>
<li><p>使用-p启动已知TCP端口的扫描，节省时间；通过-Pn强调不适用ping（默认是使用的），-sI启动空闲扫描，后面依次是僵尸主机和目标主机的ip地址。 </p>
</li>
<li><p><strong>常用命令组合</strong></p>
</li>
<li><ul>
<li>扫描一个小范围<br>nmap  192.168.230.120-128</li>
</ul>
</li>
<li></li>
<li><ol>
<li>root@kali:~#  nmap 192.168.230.120-128 </li>
<li>Starting Nmap 7.80 ( <a href="https://nmap.org/">https://nmap.org</a> ) at 2021-08-26 15:33 CST </li>
<li>Nmap scan report for  192.168.230.128 </li>
<li>Host is up (0.0019s  latency). </li>
<li>Not shown: 988 closed ports </li>
<li>PORT   STATE SERVICE </li>
<li>80/tcp  open  http </li>
<li>135/tcp  open  msrpc </li>
<li>139/tcp  open  netbios-ssn </li>
<li>445/tcp  open  microsoft-ds </li>
<li>3306/tcp open  mysql </li>
<li>3389/tcp open  ms-wbt-server </li>
<li>49152/tcp open unknown </li>
<li>49153/tcp open unknown </li>
<li>49154/tcp open unknown </li>
<li>49155/tcp open unknown </li>
<li>49156/tcp open unknown </li>
<li>49157/tcp open unknown </li>
<li>MAC Address: 00:0C:29:6C:5A:C6  (VMware) </li>
<li>Nmap done: 9 IP addresses (1 host  up) scanned in 1.77 seconds</li>
</ol>
</li>
<li><p>这里扫描到了我的另一台虚拟机 192.168.230.128</p>
</li>
<li><ul>
<li>初步扫描端口信息<br>我们扫描一下这个虚拟机的 80,443,3306,3389,6379端口<br>nmap -T4 -A -v -Pn  192.168.230.128 -p 80,443,3306,3389,6379</li>
</ul>
</li>
<li></li>
<li><ol>
<li>root@kali:~#  nmap -T4 -A -v -Pn 192.168.230.128 -p 80,443,3306,3389,6379 </li>
<li>Starting Nmap 7.80 ( <a href="https://nmap.org/">https://nmap.org</a> ) at 2021-08-26 15:43 CST </li>
<li>NSE: Loaded 151 scripts for  scanning. </li>
<li>NSE: Script Pre-scanning. </li>
<li>Initiating NSE at 15:43 </li>
<li>Completed NSE at 15:43, 0.00s  elapsed </li>
<li>Initiating NSE at 15:43 </li>
<li>Completed NSE at 15:43, 0.00s  elapsed </li>
<li>Initiating NSE at 15:43 </li>
<li>Completed NSE at 15:43, 0.00s  elapsed </li>
<li>Initiating ARP Ping Scan at  15:43 </li>
<li>Scanning 192.168.230.128 [1  port] </li>
<li>Completed ARP Ping Scan at 15:43,  0.00s elapsed (1 total hosts) </li>
<li>Initiating Parallel DNS resolution  of 1 host. at 15:43 </li>
<li>Completed Parallel DNS resolution  of 1 host. at 15:43, 0.00s elapsed </li>
<li>Initiating SYN Stealth Scan at  15:43 </li>
<li>Scanning 192.168.230.128 [5  ports] </li>
<li>Discovered open port 3306/tcp on  192.168.230.128 </li>
<li>Discovered open port 3389/tcp on  192.168.230.128 </li>
<li>Discovered open port 80/tcp on  192.168.230.128 </li>
<li>Completed SYN Stealth Scan at  15:43, 1.10s elapsed (5 total ports) </li>
<li>Initiating Service scan at  15:43 </li>
<li>Scanning 3 services on  192.168.230.128 </li>
<li>Completed Service scan at 15:43,  6.01s elapsed (3 services on 1 host) </li>
<li>Initiating OS detection (try #1)  against 192.168.230.128 </li>
<li>NSE: Script scanning  192.168.230.128. </li>
<li>Initiating NSE at 15:43 </li>
<li>Completed NSE at 15:43, 5.02s  elapsed </li>
<li>Initiating NSE at 15:43 </li>
<li>Completed NSE at 15:43, 0.03s  elapsed </li>
<li>Initiating NSE at 15:43 </li>
<li>Completed NSE at 15:43, 0.00s  elapsed </li>
<li>Nmap scan report for  192.168.230.128 </li>
<li>Host is up (0.00029s  latency). </li>
<li>PORT   STATE  SERVICE  VERSION </li>
<li>80/tcp  open   http    Apache httpd 2.4.23  ((Win32) OpenSSL/1.0.2j PHP/5.2.17) </li>
<li>| http-methods: </li>
<li>|  Supported Methods: GET HEAD POST OPTIONS  TRACE </li>
<li>|_ Potentially risky methods: TRACE </li>
<li>|_http-server-header:  Apache/2.4.23 (Win32) OpenSSL/1.0.2j PHP/5.2.17 </li>
<li>|_http-title: Index of / </li>
<li>443/tcp closed https </li>
<li>3306/tcp open  mysql    MySQL (unauthorized) </li>
<li>3389/tcp open  tcpwrapped </li>
<li>6379/tcp closed redis </li>
<li>MAC Address: 00:0C:29:6C:5A:C6  (VMware) </li>
<li>Device type: general  purpose </li>
<li>Running: Microsoft Windows  7|2008|8.1 </li>
<li>OS CPE:  cpe:/o:microsoft:windows_7::- cpe:/o:microsoft:windows_7::sp1  cpe:/o:microsoft:windows_server_2008::sp1  cpe:/o:microsoft:windows_server_2008:r2 cpe:/o:microsoft:windows_8  cpe:/o:microsoft:windows_8.1 </li>
<li>OS details: Microsoft Windows 7  SP0 - SP1, Windows Server 2008 SP1, Windows Server 2008 R2, Windows 8, or  Windows 8.1 Update 1 </li>
<li>Uptime guess: 0.196 days (since  Thu Aug 26 11:00:47 2021) </li>
<li>Network Distance: 1 hop </li>
<li>TCP Sequence Prediction:  Difficulty=259 (Good luck!) </li>
<li>IP ID Sequence Generation:  Incremental </li>
<li>TRACEROUTE </li>
<li>HOP RTT   ADDRESS </li>
<li>1  0.29 ms 192.168.230.128 </li>
<li>NSE: Script Post-scanning. </li>
<li>Initiating NSE at 15:43 </li>
<li>Completed NSE at 15:43, 0.00s  elapsed </li>
<li>Initiating NSE at 15:43 </li>
<li>Completed NSE at 15:43, 0.00s  elapsed </li>
<li>Initiating NSE at 15:43 </li>
<li>Completed NSE at 15:43, 0.00s  elapsed </li>
<li>Read data files from:  /usr/bin/../share/nmap </li>
<li>OS and Service detection  performed. Please report any incorrect results at <a href="https://nmap.org/submit/">https://nmap.org/submit/</a> . </li>
<li>Nmap done: 1 IP address (1 host  up) scanned in 13.65 seconds </li>
<li>​      Raw packets sent: 26 (1.842KB) |  Rcvd: 22 (1.570KB)</li>
</ol>
</li>
<li><p>从扫描结果来看，该虚拟机80,3306,3389端口开放，443,6379端口关闭</p>
</li>
<li><ul>
<li>判断常见的漏洞并扫描端口</li>
</ul>
</li>
<li><p>–script指定常见漏洞 nmap 192.168.230.128 –script=auth,vuln</p>
</li>
<li><p>扫描信息如下：</p>
</li>
<li></li>
<li><ol>
<li>root@kali:~#  nmap 192.168.230.128 –script=auth,vuln </li>
<li>Starting Nmap 7.80 ( <a href="https://nmap.org/">https://nmap.org</a> ) at 2021-08-26 15:50 CST                                                  </li>
<li>Nmap scan report for  192.168.230.128                                                                </li>
<li>Host is up (0.00065s  latency).                                                                   </li>
<li>Not shown: 988 closed ports                                                                    </li>
<li>PORT   STATE SERVICE                                                                      </li>
<li>80/tcp  open  http                                                                        </li>
<li>|_clamav-exec: ERROR: Script  execution failed (use -d to debug)                                                  </li>
<li>| http-csrf:                                                                            </li>
<li>| Spidering limited to:  maxdepth=3; maxpagecount=20; withinhost=192.168.230.128                                          </li>
<li>|  Found the following possible CSRF  vulnerabilities:                                                       </li>
<li>|                                                                                 </li>
<li>|   Path: <a href="http://192.168.230.128/2.php">http://192.168.230.128:80/2.php</a>                                                            </li>
<li>|   Form id:                                                                           </li>
<li>|_  Form action: 2.php </li>
<li>|_http-dombased-xss: Couldn’t find  any DOM based XSS. </li>
<li>| http-enum: </li>
<li>|  /: Root directory w/ directory  listing </li>
<li>|_ /uploads/: Potentially interesting  folder </li>
<li>| http-slowloris-check: </li>
<li>|  VULNERABLE: </li>
<li>|  Slowloris DOS attack </li>
<li>|   State: LIKELY VULNERABLE </li>
<li>|   IDs:  CVE:CVE-2007-6750 </li>
<li>|    Slowloris tries to keep many connections  to the target web server open and hold </li>
<li>|    them open as long as possible. It accomplishes this by opening connections  to </li>
<li>|    the target web server and sending a  partial request. By doing so, it starves </li>
<li>|    the http server’s resources causing  Denial Of Service. </li>
<li>|    </li>
<li>|   Disclosure date: 2009-09-17 </li>
<li>|   References: </li>
<li>|    <a href="http://ha.ckers.org/slowloris/">http://ha.ckers.org/slowloris/</a> </li>
<li>|_   <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750</a> </li>
<li>| http-sql-injection: </li>
<li>|  Possible sqli for forms: </li>
<li>|   Form at path: /2.php, form’s action:  2.php. Fields that might be vulnerable: </li>
<li>|_   username </li>
<li>|_http-stored-xss: Couldn’t find  any stored XSS vulnerabilities. </li>
<li>|_http-trace: TRACE is  enabled </li>
<li>135/tcp  open  msrpc </li>
<li>|_clamav-exec: ERROR: Script  execution failed (use -d to debug) </li>
<li>139/tcp  open  netbios-ssn </li>
<li>|_clamav-exec: ERROR: Script  execution failed (use -d to debug) </li>
<li>445/tcp  open  microsoft-ds </li>
<li>|_clamav-exec: ERROR: Script  execution failed (use -d to debug) </li>
<li>3306/tcp open  mysql </li>
<li>|_clamav-exec: ERROR: Script  execution failed (use -d to debug) </li>
<li>|_mysql-empty-password: Host  ‘192.168.230.129’ is not allowed to connect to this MySQL server </li>
<li>|_mysql-vuln-cve2012-2122: ERROR:  Script execution failed (use -d to debug) </li>
<li>3389/tcp open  ms-wbt-server </li>
<li>|_clamav-exec: ERROR: Script  execution failed (use -d to debug) </li>
<li>|_sslv2-drown: </li>
<li>49152/tcp open unknown </li>
<li>|_clamav-exec: ERROR: Script  execution failed (use -d to debug) </li>
<li>49153/tcp open unknown </li>
<li>|_clamav-exec: ERROR: Script  execution failed (use -d to debug) </li>
<li>49154/tcp open unknown </li>
<li>|_clamav-exec: ERROR: Script  execution failed (use -d to debug) </li>
<li>49155/tcp open unknown </li>
<li>|_clamav-exec: ERROR: Script  execution failed (use -d to debug) </li>
<li>49156/tcp open unknown </li>
<li>|_clamav-exec: ERROR: Script  execution failed (use -d to debug) </li>
<li>49157/tcp open unknown </li>
<li>|_clamav-exec: ERROR: Script  execution failed (use -d to debug) </li>
<li>MAC Address: 00:0C:29:6C:5A:C6  (VMware) </li>
<li>Host script results: </li>
<li>|_samba-vuln-cve-2012-1182:  NT_STATUS_ACCESS_DENIED </li>
<li>|_smb-vuln-ms10-054: false </li>
<li>|_smb-vuln-ms10-061:  NT_STATUS_ACCESS_DENIED </li>
<li>| smb-vuln-ms17-010: </li>
<li>|  VULNERABLE: </li>
<li>|  Remote Code Execution vulnerability in  Microsoft SMBv1 servers (ms17-010) </li>
<li>|   State: VULNERABLE </li>
<li>|   IDs:  CVE:CVE-2017-0143 </li>
<li>|   Risk factor: HIGH </li>
<li>|    A critical remote code execution  vulnerability exists in Microsoft SMBv1 </li>
<li>|    servers (ms17-010). </li>
<li>|      </li>
<li>|   Disclosure date: 2017-03-14 </li>
<li>|   References: </li>
<li>|    <a href="https://technet.microsoft.com/en-us/library/security/ms17-010.aspx">https://technet.microsoft.com/en-us/library/security/ms17-010.aspx</a> </li>
<li>|    <a href="https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/">https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/</a> </li>
<li>|_   <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0143">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0143</a> </li>
<li>Nmap done: 1 IP address (1 host  up) scanned in 118.86 seconds</li>
</ol>
</li>
<li><ul>
<li>典型的 nmap 扫描<br>nmap -A -T4<br>扫描信息如下：</li>
</ul>
</li>
<li></li>
<li><ol>
<li>root@kali:~#  nmap -A -T4 192.168.230.128 </li>
<li>Starting Nmap 7.80 ( <a href="https://nmap.org/">https://nmap.org</a> ) at 2021-08-26 16:07 CST </li>
<li>Nmap scan report for  192.168.230.128 </li>
<li>Host is up (0.00099s  latency). </li>
<li>Not shown: 988 closed ports </li>
<li>PORT   STATE SERVICE   VERSION </li>
<li>80/tcp  open  http     Apache httpd 2.4.23  ((Win32) OpenSSL/1.0.2j PHP/5.2.17) </li>
<li>| http-methods: </li>
<li>|_ Potentially risky methods: TRACE </li>
<li>|_http-server-header:  Apache/2.4.23 (Win32) OpenSSL/1.0.2j PHP/5.2.17 </li>
<li>|_http-title: Index of / </li>
<li>135/tcp  open  msrpc    Microsoft Windows  RPC </li>
<li>139/tcp  open  netbios-ssn Microsoft Windows  netbios-ssn </li>
<li>445/tcp  open  microsoft-ds Windows Server 2008 HPC Edition 7601 Service Pack 1  microsoft-ds </li>
<li>3306/tcp open  mysql    MySQL  (unauthorized) </li>
<li>3389/tcp open  tcpwrapped </li>
<li>|_ssl-date:  2021-08-26T08:08:29+00:00; 0s from scanner time. </li>
<li>49152/tcp open msrpc     Microsoft Windows RPC </li>
<li>49153/tcp open msrpc     Microsoft Windows RPC </li>
<li>49154/tcp open msrpc     Microsoft Windows RPC </li>
<li>49155/tcp open msrpc     Microsoft Windows RPC </li>
<li>49156/tcp open msrpc     Microsoft Windows RPC </li>
<li>49157/tcp open msrpc     Microsoft Windows RPC </li>
<li>MAC Address: 00:0C:29:6C:5A:C6  (VMware) </li>
<li>Device type: general  purpose </li>
<li>Running: Microsoft Windows  7|2008|8.1 </li>
<li>OS CPE:  cpe:/o:microsoft:windows_7::- cpe:/o:microsoft:windows_7::sp1  cpe:/o:microsoft:windows_server_2008::sp1  cpe:/o:microsoft:windows_server_2008:r2 cpe:/o:microsoft:windows_8  cpe:/o:microsoft:windows_8.1 </li>
<li>OS details: Microsoft Windows 7  SP0 - SP1, Windows Server 2008 SP1, Windows Server 2008 R2, Windows 8, or  Windows 8.1 Update 1 </li>
<li>Network Distance: 1 hop </li>
<li>Service Info: OSs: Windows,  Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows </li>
<li>Host script results: </li>
<li>|_clock-skew: mean: -1h59m59s,  deviation: 3h59m59s, median: 0s </li>
<li>|_nbstat: NetBIOS name:  WIN-5QVLF6I9FUL, NetBIOS user: <unknown>, NetBIOS MAC: 00:0c:29:6c:5a:c6  (VMware) </unknown></li>
<li>| smb-os-discovery: </li>
<li>|  OS: Windows Server 2008 HPC Edition 7601  Service Pack 1 (Windows Server 2008 HPC Edition 6.1) </li>
<li>|  OS CPE:  cpe:/o:microsoft:windows_server_2008::sp1 </li>
<li>|  Computer name: WIN-5QVLF6I9FUL </li>
<li>|  NetBIOS computer name:  WIN-5QVLF6I9FUL\x00 </li>
<li>|  Workgroup: WORKGROUP\x00 </li>
<li>|_ System time: 2021-08-26T16:08:14+08:00 </li>
<li>| smb-security-mode: </li>
<li>|  account_used: guest </li>
<li>|  authentication_level: user </li>
<li>|  challenge_response: supported </li>
<li>|_ message_signing: disabled (dangerous, but  default) </li>
<li>| smb2-security-mode: </li>
<li>|  2.02: </li>
<li>|_  Message signing enabled but not  required </li>
<li>| smb2-time: </li>
<li>|  date: 2021-08-26T08:08:14 </li>
<li>|_ start_date: 2021-07-30T07:34:36 </li>
<li>TRACEROUTE </li>
<li>HOP RTT   ADDRESS </li>
<li>1  0.99 ms 192.168.230.128 </li>
<li>OS and Service detection  performed. Please report any incorrect results at <a href="https://nmap.org/submit/">https://nmap.org/submit/</a> . </li>
<li>Nmap done: 1 IP address (1 host  up) scanned in 136.80 seconds</li>
</ol>
</li>
<li><ul>
<li>nmap 基本使用方法小结</li>
</ul>
</li>
<li></li>
<li><ol>
<li>nmap  -sT ip_address #TCP contect()端口扫描 </li>
<li>nmap -p 1-65535 -T4 -A -v ip  #扫描1-65535（基本覆盖所有端口） </li>
<li>nmap -sU ip_address  #UDP端口扫描</li>
</ol>
</li>
<li><p><strong>NSE****脚本引擎</strong></p>
</li>
<li><p>NSE脚本引擎(Nmap Scripting Engine)是nmap最强大，最灵活的功能之一，允许用户自己编写脚本来执行自动化的操作或者扩展nmap的功能。</p>
</li>
<li><p>nmap的脚本库的路径：/usr/share/nmap/scripts ，该目录下的文件都是nse脚本</p>
</li>
<li><p>NSE使用Lua脚本语言，并且默认提供了丰富的脚本库，目前已经包含了14个类别的350多个脚本。NSE的设计初衷主要考虑以下几个方面</p>
</li>
<li><p>网络发现（Network Discovery）</p>
</li>
<li><p>更加复杂的版本侦测（例如 skype 软件）</p>
</li>
<li><p>漏洞侦测(Vulnerability Detection)</p>
</li>
<li><p>后门侦测(Backdoor Detection)</p>
</li>
<li><p>漏洞利用(Vulnerability Exploitation) </p>
</li>
<li><p>例如：</p>
</li>
<li><ul>
<li>nmap -script smb-vuln-ms17-010  192.168.230.128 可以探测该主机是否存在ms17_010漏洞 </li>
<li>nmap -p 80 —script  http-iis-short-name-brute +ip(192.168.1.1)[验证iis短文件名泄露] </li>
<li>nmap -sV -p 11211 -script  memcached-info +ip[验证Memcached未授权访问漏洞] </li>
<li>nmap -sV -（-）script http-vuln-cve2015-1635  +ip[验证http.sys远程代码执行漏洞] </li>
<li>nmap -sV —script=ssl-heartbleed  +ip[验证心脏出血漏洞] </li>
<li>nmap -p 27017 —script mongodb-info  +ip[验证Mongodb未授权访问漏洞] </li>
<li>nmap  —script=http-vuln-cve2015-1427 —script-args command=‘ls’ +ip[验证Elasticsearch未授权访问漏洞] </li>
<li>nmap -p 873 —script rsync-brute  —script-args ‘rsync-brute.module=www’ [验证Rsync未授权访问漏洞] </li>
<li>nmap -p 6379 —script redis-info  192.168.230.128 可以探测该主机是否存在Redis未授权访问<br>这里我给这台虚拟机安装一下Redis环境，用nmap来测试一下<br>nmap -p 6379 –script  redis-info 192.168.230.128<br>扫描信息如下：</li>
</ul>
</li>
<li><p><img src="/Nmap.files/image005.png" alt="img"></p>
</li>
<li><p>当然nmap能扫描的漏洞还有很多，有兴趣的可以查阅相关文章，比如：</p>
</li>
<li><ul>
<li><a href="https://blog.csdn.net/jiangliuzheng/article/details/51992220">https://blog.csdn.net/jiangliuzheng/article/details/51992220</a></li>
</ul>
</li>
<li><p><strong>版本侦测用法</strong></p>
</li>
<li><p>比如目标主机把SSH的22号端口改成了2222端口，那么如果使用普通扫描只会发现2222端口是开启的，并不能知道2222号端口上运行的程序，通过加参数 -sV 进行版本扫描，可以探测到目标主机上2222端口运行的是SSH服务</p>
</li>
<li><p>V:  指定让Nmap进行版本侦测</p>
</li>
<li><p>—version-intensity <level>: 指定版本侦测强度（0-9），默认为7。数值越高，探测出的服务越准确，但是运行时间会比较长。</level></p>
</li>
<li><p>—version-light: 指定使用轻量侦测方式 (intensity 2)</p>
</li>
<li><p>—version-all: 尝试使用所有的probes进行侦测 (intensity 9)</p>
</li>
<li><p>—version-trace: 显示出详细的版本侦测过程信息</p>
</li>
<li><p><strong>OS****侦测</strong></p>
</li>
<li><p>操作系统侦测用于检测目标主机运行的操作系统类型及设备类型等信息。</p>
</li>
<li><p>Nmap拥有丰富的系统数据库nmap-os-db，目前可以识别2600多种操作系统与设备类型。</p>
</li>
<li><p><strong>OS****侦测原理</strong></p>
</li>
<li><p>Nmap使用TCP/IP协议栈指纹来识别不同的操作系统和设备。在RFC规范中，有些地方对TCP/IP的实现并没有强制规定，由此不同的TCP/IP方案中可能都有自己的特定方式。Nmap主要是根据这些细节上的差异来判断操作系统的类型的。</p>
</li>
<li><p><strong>操作指令：</strong></p>
</li>
<li><p>Nmap内部包含了2600多已知系统的指纹特征（在文件nmap-os-db文件中）。将此指纹数据库作为进行指纹对比的样本库。</p>
</li>
<li><p>分别挑选一个open和closed的端口，向其发送经过精心设计的TCP/UDP/ICMP数据包，根据返回的数据包生成一份系统指纹。</p>
</li>
<li><p>将探测生成的指纹与nmap-os-db中指纹进行对比，查找匹配的系统。如果无法匹配，以概率形式列举出可能的系统。</p>
</li>
<li><p>OS侦测用法#</p>
</li>
<li><p>-O:  指定Nmap进行OS侦测。</p>
</li>
<li><p>—osscan-limit: 限制Nmap只对确定的主机的进行OS探测（至少需确知该主机分别有一个open和closed的端口）。</p>
</li>
<li><p>—osscan-guess: 大胆猜测对方的主机的系统类型。由此准确性会下降不少，但会尽可能多为用户提供潜在的操作系统</p>
</li>
<li><p><strong>输出格式</strong></p>
</li>
<li><ul>
<li>-oX XML：XML格式<br>nmap -A 192.168.230.128 -oX  “/1.xml”</li>
</ul>
</li>
<li><p><img src="/Nmap.files/image006.png" alt="img"></p>
</li>
<li><ul>
<li>-oG 可检索的: 可检索格式</li>
</ul>
</li>
<li><p><img src="/Nmap.files/image007.png" alt="img"></p>
</li>
<li><ul>
<li>-oA: 所有: 可检索的、常规的和XML文件<br>nmap -A 192.168.230.128 -oA  “/test”</li>
</ul>
</li>
<li><p><img src="/Nmap.files/image008.png" alt="img"></p>
</li>
<li><p>使用该命令会同时生成三个文件指定名称的文件</p>
</li>
<li><ul>
<li>-oN: 常规: 常规格式，适合人阅读<br>nmap -A 192.168.230.128 -oN  “/1.txt”</li>
</ul>
</li>
<li><p><img src="/Nmap.files/image009.png" alt="img"></p>
</li>
<li><p>来自  <a href="https://bbs.zkaq.cn/t/5725.html">https://bbs.zkaq.cn/t/5725.html</a></p>
</li>
</ul>
<p>已使用  OneNote 创建。</p>

        
    </div>
    </div>

    <div class="article-badge">
        
        
    </div>

</div>

<footer class="article-footer">
    <div class="article-more-info">
    <div class="article-date">
  <time datetime="2022-09-26T05:02:24.000Z" itemprop="datePublished">2022-09-26</time>
</div>
    
        <div class="article-category">
        <a class="article-category-link" href="/categories/SecTools/">SecTools</a>
        </div>
    
    
        <div class="article-tag">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tools/" rel="tag">Tools</a></li></ul>
        </div>
    
    </div>
</footer>

</article>

    
  
    
      <article
id="post-渗透测试——信息收集"
class="article article-type-post"
>



<div class="article-inner">
    
    <div class="article-feature">
        <a href="/2022/collect/">
            <img
                src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 3 2'%3E%3C/svg%3E"
                data-src="https://s2.loli.net/2022/10/15/fjwcy8FW7NxibDG.png"
                alt="item.title"
                class="lazy"
            />
        </a>
    </div>
    

    <div class="article-body">
    <header class="article-title">
        <a href="/2022/collect/">渗透测试——信息收集</a>
    </header>
    <div class="article-entry post-inner-html">
        
        <p>信息收集</p>
<p>2022年8月15日</p>
<p>（1）学号、工号、电话、邮箱、默认密码、身份证信息等等。</p>
<p>（2）子域名、旁站、C段、站点下的目录文件、JS接口等等。</p>
<p>（3）每个子站的配置环境、用的系统或者是CMS、系统的默认密码等等。</p>
<p>（4）有些学校的网站系统是外包给别的公司开发的，有时候可以从系统开发公司下手。</p>
<p>fofa语句（查找edu里的管理系统）:</p>
<p>“管理系统” &amp;&amp; org=”China Education and Research Network Center”</p>
<p>使用Google语法进行收集：</p>
<p>site:”edu.cn”</p>
<p>inurl:login|admin|manage|member|admin_login|login_admin|system|login|user|main|cms</p>
<p>查找文本内容：</p>
<p>site:域名 intext:管理|后台|登陆|用户名|密码|验证码|系统|帐号|admin|login|sys|managetem|password|username</p>
<p>查找可注入点：site:域名 inurl:aspx|jsp|php|asp</p>
<p>查找上传漏洞：site:域名 inurl:file|load|editor|Files</p>
<p>找eweb编辑器：</p>
<p>site:域名 inurl:ewebeditor|editor|uploadfile|eweb|edit</p>
<p>存在的数据库：site:域名 filetype:mdb|asp|#</p>
<p>查看脚本类型：site:域名 filetype:asp/aspx/php/jsp</p>
<p>迂回策略入侵：inurl:cms/data/templates/images/index/</p>
<p>ICP备案查询：<a href="https://icp.aizhan.com/">https://icp.aizhan.com</a></p>
<p>权重查询：<a href="https://rank.aizhan.com/www.wondercv.com/">https://rank.aizhan.com/www.wondercv.com/</a></p>
<p>多地ping：<a href="https://www.ping.cn/d">https://www.ping.cn/d</a></p>
<p>whois查询：<a href="https://www.whois365.com/cn/ip/119.23.74.200">https://www.whois365.com/cn/ip/119.23.74.200</a></p>
<p>IP反查：<a href="https://www.ip138.com/iplookup.asp?ip=166.111.53.94&amp;action=2">https://www.ip138.com/iplookup.asp?ip=166.111.53.94&amp;action=2</a></p>
<p>以xxx公司为例，根域名：xxx.cn</p>
<p>信息收集可以从多个领域来看：公司，子公司，域名，子域名，IPV4，IPV6，小程序，APP，PC软件等等</p>
<p>可以重点关注备案网站，APP，小程序，微信公众号，甚至是微博。</p>
<p>这里说一点小思路，首先可以找到官网，用cmd ping他的官网，可以看到IP地址，然后可以定位whois，whois中包含了用户、邮箱，以及购买的网段。</p>
<p>有了网段就可以进行一些主动信息收集，可以使用一些强大的资产测绘工具，goby的资产测绘还是很不错的，会有一些web服务，不用担心没有banner，往往这些没有banner的才有问题。</p>
<p>注意观察一下网站底部是否有技术支持：xxxx|网站建设：xxxx之类的标注，一些建站企业会出于知识产权保护或者是对外宣传自己的公司，会在自家搭建的网站上挂上技术支持等之类的标注，很多建站企业往往某种类型的网站都是套用的同一套源码，换汤不换药，运气不错的话，那我们的事件就秒变通用。</p>
<p>谷歌语法</p>
<p>sql注入</p>
<p>inurl:php?id=</p>
<p>inurl:asp?id</p>
<p>inurl:Show.asp?ID=</p>
<p>inurl：xxx.edu.cn 学号</p>
<p>地区inurl:”type_id=1”</p>
<p>行业inurl:”ptherinfo.asp?id=1”</p>
<p>还可以将php替换为asp、aspx、jsp等站点。</p>
<p>Xss:</p>
<p>地区inurl:”search?kw=”、inurl:’Product.asp?BigClassName’</p>
<p>任意注册</p>
<p>地区/行业inurl:”register”、地区/行业inurl:”regp.asp”、Reg.asp、userreg.asp、reg1.asp</p>
<p>CMS通杀</p>
<p>建议可以去一些漏洞文库，</p>
<p>建议多进行漏洞复现，多实战，多积累实战经验，复现漏洞也是一种积累。</p>
<p>弱口令</p>
<p>山西inurl:”后台”</p>
<p>账号：admin/test/cs/ceshi/test01等 密码：admin/123456/a123456/admin123/admin123456等。</p>
<p>也可以借助fofa对后台站点进行搜索：title=”后台管理” &amp;&amp; country=”CN”</p>
<p>Site：.edu.cn 登录 注册 忘记密码</p>
<p>site：.edu.cn 缴费</p>
<p>批量查询语法</p>
<p>site:edu.cn inurl:/payment intitle:大学缴费平台</p>
<p>子域名收集</p>
<p>在线子域名收集</p>
<p><a href="https://phpinfo.me/domain/">https://phpinfo.me/domain/</a></p>
<p>Fofa语法：</p>
<p>body=”xxx系统” &amp;&amp; org=”China Education and Research Network Center”</p>
<p>goby</p>
<p>登陆处没有验证码，可爆破</p>
<p>找到规则：</p>
<p>（1）账户：xxxx+学号</p>
<p>（2）密码：默认密码一般来说是身份证后6位，也可能是xxxx+身份证后6位</p>
<p>（3）学号：这个最好自己能收集到，一般是：入学年份+专业编码+数字</p>
<p>弱口令123456、123456789</p>
<p>越权漏洞</p>
<p>越权修改其他账户的密码</p>
<p>loginname传参</p>
<p>whois查找网站 注册邮箱，手机号</p>
<p>post型是是sql注入</p>
<p>存储型xss</p>
<p>c段扫描</p>
<p>1.登陆</p>
<p>登陆处一般会出现</p>
<p>sql注入</p>
<p>如果密码错误，修改返回包，返回一个其他人正常登录的返回包进行逃逸</p>
<p>反射xss</p>
<p>越权 抓返回包 具体参数如：role,roleid,user,admin,id,manage</p>
<p>信息泄露 极有可能泄露该账号的全部信息 但是前端只显示了部分</p>
<p>  无验证码可爆破</p>
<p>  验证码登陆爆破(4位，或长期有效)</p>
<p>  验证码登陆绕过</p>
<p>  验证码在返回包</p>
<p>  短信轰炸</p>
<p>  邮箱轰炸</p>
<p>  sesslon覆盖</p>
<p>  万能密码</p>
<p>  post注入</p>
<p>  xss</p>
<p>2.注册</p>
<p>  任意用户注册</p>
<p>  注册覆盖</p>
<p>  验证码在返回包</p>
<p>  短信轰炸</p>
<p>  邮箱轰炸</p>
<p>  xss</p>
<p>3.密码找回</p>
<p>  任意用户密码重置</p>
<p>  密保问题在前端源码</p>
<p>  验证码爆破</p>
<p>  手机号码篡改为自己的接收短信验证码</p>
<p>  邮箱篡改为自己的接收短信验证码</p>
<p>忘记密码处可能存在：</p>
<p>sql注入</p>
<p>任意密码修改 如果没有二次验证这个洞基本就存在</p>
<p>反射xss</p>
<p>信息泄露</p>
<p>验证码爆破</p>
<p>验证码轰炸</p>
<p>4.会员系统(报名系统)</p>
<p>  用户越权访问</p>
<p>  订单越权查看修改</p>
<p>  收货地址越权查看修改</p>
<p>  资料越权查看修改</p>
<p>  换绑手机号码短信轰炸</p>
<p>  水平垂直越权</p>
<p>  接口查询</p>
<p>  数据泄露</p>
<p>  文件上传</p>
<p>  资料处xss</p>
<p>  csrf</p>
<p>5.支付系统</p>
<p>  商品价格修改</p>
<p>  优惠卷数量修改</p>
<p>  折扣修改</p>
<p>  商品数量修改</p>
<p>  支付金额修改</p>
<p>  积分修改</p>
<p>  收货地址越权遍历</p>
<p>  订单查看</p>
<p>  备注处xss</p>
<p>  支付成功订单重放</p>
<p>  优惠数量限制突破</p>
<p>第一种思路：批量挖</p>
<p>0day、Nday刷</p>
<p>利用工具：</p>
<p>Fofamap：一款利用fofa api收集url的工具 还可以进行漏洞扫描，nuclei扫描</p>
<p>前提：需要fofa高级会员（或者使用url采集器）</p>
<p>fofa语法：</p>
<p>tittle=”职业学院” &amp;&amp; status_code=”200”</p>
<p>host=”.edu.cn” &amp;&amp; status_code=”200”</p>
<p>采集完url后，可以跑一遍nuclei</p>
<p>接下来可以用afrog，一款批量跑poc的工具</p>
<p>第二种思路：外网挖掘</p>
<p>没有学校的VPN，只能在外网进行挖掘，首先进行信息收集</p>
<p>先挖最简单的洞，身份证信息泄露</p>
<p>利用Google黑客语法：site:xxx.edu.cn 身份证</p>
<p>该语法可以用必应，谷歌，百度搜索</p>
<p>如果查到未打码的身份证信息，低危信息泄露提交</p>
<p>收集学号</p>
<p>Site:xxx.edu.cn 学号</p>
<p>收集完之后开始找站</p>
<p>如果进不去统一认证的话，先找外围资产</p>
<p>Site://xxx.edu.cn 注册/忘记密码/登录等等</p>
<p>去这种有输入框的地方找可以爆破的点，或者用语法去搜站点默认密码</p>
<p>尝试爆破，基本可以爆出来几个弱口令</p>
<p>如果可以注册，那就自己注册，进行挖掘</p>
<p>登录网站后，开始挖洞</p>
<p>打开burp，从点击登录的开始就要开始抓包</p>
<p>不要放过任何一个返回包</p>
<p>任何功能点都不要放过，任何一个逻辑点不要放过</p>
<p>edu最多的就是信息泄露，逻辑漏洞</p>
<p>任何可以跳转的地方，都有可能存在信息泄露，越权</p>
<p>sql注入 凡是和数据库交互的地方都可能存在</p>
<p>Xss 文件上传黑白名单，文件名绕过，csrf等具体的owasp10</p>
<p>某个边缘资产用了什么cms，百度一下它的漏洞，exp</p>
<p>必须要会的手法，看js文件</p>
<p>有时候它的js文件里面会存在许多敏感信息</p>
<p>甚至是要学会自己拼凑前端想要的一些值</p>
<p>找js文件接口的工具：<strong>jsFinder</strong></p>
<p><strong>目录扫描</strong> <strong>端口扫描都是必要的</strong></p>
<p>最后尝试搜索学校的小程序，公众号</p>
<p>挖的最多的洞是信息泄露，其次逻辑漏洞，未授权，sql 注入</p>

        
    </div>
    </div>

    <div class="article-badge">
        
        
    </div>

</div>

<footer class="article-footer">
    <div class="article-more-info">
    <div class="article-date">
  <time datetime="2022-09-26T04:59:40.000Z" itemprop="datePublished">2022-09-26</time>
</div>
    
        <div class="article-category">
        <a class="article-category-link" href="/categories/Sec/">Sec</a>
        </div>
    
    
        <div class="article-tag">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Sec/" rel="tag">Sec</a></li></ul>
        </div>
    
    </div>
</footer>

</article>

    
  
    
      <article
id="post-渗透测试——Blame-edusrc"
class="article article-type-post"
>



<div class="article-inner">
    

    <div class="article-body">
    <header class="article-title">
        <a href="/2022/blame-edusrc/">渗透测试——Blame_edusrc</a>
    </header>
    <div class="article-entry post-inner-html">
        
        <p>Blame</p>
<p>2022年8月21日</p>
<p>10:41</p>
<ul>
<li>信息收集</li>
</ul>
<ol>
<li>身份证</li>
</ol>
<p>site:xxx.edu.cn intext:”身份证” filetype:pdf/docx/pptx/xls+身份证号</p>
<p>技巧：”身份证”替换为证件号</p>
<p>多加一些其他关键词 比如”公示””名单””发展对象””入党”泄露比较多</p>
<p>“拟”</p>
<p>edu大部分账号都是与身份证相关的，一个信息泄露1rank，能够为后续的渗透打基础。</p>
<p>搜素语法、更换搜索引擎（针对单独学校去找）</p>
<p>Googel 必应</p>
<p><img src="https://img.gejiba.com/images/2af86dba3d486f228762f03a4a1c1ef4.png" alt="2af86dba3d486f228762f03a4a1c1ef4.png"></p>
<p>批量去找：site：edu.cn</p>
<p>更换关键词：职业技术学院、航天大学、财经大学、第一中学、理工大学、市中学、省重点中学等等</p>
<p>一般职业技术学院泄露比较多</p>
<p>重复率过高的问题：避免热词（奖学金、采购、合同、专家、审计、单一来源采购）</p>
<p>edu院校榜漏洞较少的学校  推荐教育厅下面的域名网站去找</p>
<p>其他技巧：找图片</p>
<p>组合拳语法：</p>
<p>姓名  学号 身份证号 联系电话 filetype:xlsx inurl:edu.cn</p>
<p>密码  filetype:txt inurl:新建文本文档</p>
<p>inurl:phpinfo.php  intitle:phpinfo()</p>
<ol>
<li>找账号</li>
</ol>
<p>1.了解密码规则：身份证后6位、12-17位（默认密码）</p>
<p>2.找到身份证 最好要有对应的名字然后去找这个学校下面这个人的学号，（可以尝试其他关联网站 比如gov等信息网站）</p>
<p>3.进系统 找资产的方法</p>
<p>4.github的信息收集 账号密码</p>
<ol>
<li>找资产</li>
</ol>
<p>1.只要变更语法就可以找到</p>
<p>site:xxx.edu.cn  intext:”xxx”</p>
<p>inurl:edu.cn</p>
<p>登录、注册、忘记密码、统一支付、后台管理、教务、教育平台</p>
<p>2.fofa走一波</p>
<p>根据上述关键词去对比不同会有收获</p>
<p>“后勤管理系统”</p>
<p>3.公众号、小程序</p>
<p>4.一些厂商下面的域名也有学校的资产</p>
<p>site:某开发商域名  “大学”</p>
<p>子域名：在线子域名工具 <a href="https://phpinfo.me/domain/">https://phpinfo.me/domain/</a></p>
<ul>
<li>Sql注入</li>
</ul>
<p>字段：id、tid、keyword</p>
<p>数字型注入</p>
<p>‘ and  1=1 –+</p>
<p>‘ and  1=2 –+</p>
<p>测字段N order by N –+</p>
<p>sqlmap –batch 默认yes执行</p>
<p>sql注入可能出现的地方：</p>
<p>1.登录</p>
<p>2.表单–&gt;提交</p>
<p>3.url 参数</p>
<p>4.cookie</p>
<p>5.header</p>
<p>6.搜索</p>
<p>7.注册</p>
<p>8.修改密码</p>
<p>9.文章列表</p>
<p>10.订单信息</p>
<p>11.新增文章</p>
<p>任何输入参数与后端数据库交互的地方</p>
<p>1.GET/POST/PUT/DELETE 参数</p>
<p>2.数据包内我们可控的参数 例如xff头</p>
<p>3.搜索处、更新个人资料、页面靠莫i个参数来回显 例如id、pid参数</p>
<p>常用检测语句：</p>
<p>‘or  1=1%23</p>
<p>“or</p>
<p>“)</p>
<p><img src="https://img.gejiba.com/images/76b5c3ff8248556fe61f85d2de3a06aa.png" alt="76b5c3ff8248556fe61f85d2de3a06aa.png"></p>
<p>判读数据库类型：</p>
<p>exp()函数</p>
<p>exp(710)+exp(710) Mysql</p>
<p>exp(210)+exp(209)  oracle</p>
<p>.net  mssql/sqlserver</p>
<p>页面反应的分析逻辑：</p>
<p>1.有回显的</p>
<p>直接出现sql语句 ——&gt;报错注入  updatexml(1,concat(‘~’,(select+database()),1))%23</p>
<p>2.无回显的 sleep(2) exp(210)判断 ——&gt;dnslog （理解一个true false的概念）</p>
<p>3.搜索框注入方式——&gt;猜测sql语句 </p>
<p>找到闭合的规则</p>
<ul>
<li>越权（逻辑）</li>
</ul>
<p>敏感参数水平越权：userKey、value、personId、</p>
<p>垂直越权:修改用户属性对应type参数值 student、teacher、admin</p>
<p>验证码越权使用、验证码复用</p>
<p>越权下载 修改参数id</p>
<p>任意密码重置：修改请求中id，name，data这种类似的参数越权修改其他用户密码</p>
<ul>
<li>文件上传</li>
</ul>
<p>修改头像处</p>
<p>白名单限制、只下载不解析</p>
<p>jsp文件、html文件构造xss</p>
<p>上传文件名目录穿越</p>
<ul>
<li>Gethell </li>
<li>内网的简单操作 </li>
<li>XSS、文件读取、下载、弱口令、RCE</li>
</ul>
<p>注册登录 修改个人信息 输入框 XSS  <script>alert(/xss/)<script></p>
<ul>
<li>统一认证的挖掘思路 </li>
<li>swagger的未授权（接口文档的利用） </li>
<li>edu通用漏洞批量打 </li>
<li>通杀挖掘思路 </li>
<li>证书站外围资产</li>
</ul>
<p><strong>难度由简到难</strong></p>
<p>交大</p>
<p>电子科大</p>
<p>同济</p>
<p>上理</p>
<p>常熟</p>
<p>广工</p>
<p>兰州</p>
<p>上外</p>
<p>南开</p>
<p>东林</p>
<p>长春</p>
<p>上音</p>
<p>1.没有VPN的思路 外围网站收集</p>
<ul>
<li>注册点 </li>
<li>边缘登录 </li>
<li>老破小 </li>
<li>小程序 </li>
<li>公众号 </li>
<li>院校类内部的小众系统</li>
</ul>
<p>Step 1：</p>
<p>Googel语法： 更换与学校相关的关键词 </p>
<p>site:xxx.edu.cn "登录"  "注册" "验证码" "忘记密码" "管理"</p>
<p>"xx大学" "后台管理" "管理系统" "登录"--->找边缘资产</p>
<p>可能会找到只有ip的系统 没有域名归属</p>
<p>学报、平台指南、教学辅助系统</p>
<p>Step 2：</p>
<p>Fofa、zoomeye、bing走一波</p>
<p>不同搜索引擎的关键字获得的信息不同</p>
<p>Step 3：</p>
<p>去找小程序、公众号</p>
<p>公众号抓包比较容易 小程序抓包需要配置</p>
<p>文章类的忽略</p>
<p>xx查询一般可能存在sql注入</p>
<p>pc端 小程序端的接口一般是分开来写的 一部分是公共调用的</p>
<p>真正系统的薄弱点，存在于公众号+小程序</p>
<p>我们可以通过获取小程序，公众号的域名来反推PC端可能存在的系统</p>
<p>域名后面加个admin、main、home、system常见系统主页界面路径</p>
<p>Step 4：钓鱼、社工、搞密码</p>
<ul>
<li>EDU常见思路与系统挖掘测试</li>
</ul>
<ol>
<li>挖洞当中要进行学习，每天留半个小时看看文章  觉得不错试试总结一下 </li>
<li>看到空白页——>找找js  可能是api服务器 盲猜一下接口 或者fuzz </li>
<li>外网的一般系统：</li>
</ol>
<p>3.1 登录注册 忘记密码：（越权 注入一般很少 未授权从js当中看）</p>
<p>有些部分接口是可以通过改包越过的 但是并不是所有</p>
<p>进入系统后：</p>
<p>3.2 找我的账号信息 我的roleid 我的名字</p>
<p>我的信息是通过接口返回的</p>
<p>还是页面直接写上去</p>
<p>或者写入到js里面</p>
<p>第一层：就是看看是否能越权</p>
<p>第二层：理解每一个接口都干了什么事情</p>
<p>api/menu/init</p>
<p>api/menu/userInfo json数据 html页面</p>
<p>做对比：</p>
<p>正常情况下的页面是什么样子</p>
<p>改完之后页面是什么样子</p>
<p>3.3理解接口含义</p>
<p>根据返回的参数 来确定是否存在利用价值</p>
<p>3.4 利用整个系统的权限规则</p>
<p>3.5 文件上传</p>
<p>从js里面去找upload相关词的接口</p>
<p>找业务上传点</p>
<p>判断是否黑白名单</p>
<p>3.6 基于内部系统中可能存在不同与外部的js文件 接口其他的东西</p>
<p>RCE 版本框架漏洞 cms 这种类型的百度就可以</p>
<p>构造报错——>获取版本信息</p>
<p>已使用  OneNote 创建。</p>
</script></p>
        
    </div>
    </div>

    <div class="article-badge">
        
        
    </div>

</div>

<footer class="article-footer">
    <div class="article-more-info">
    <div class="article-date">
  <time datetime="2022-09-26T04:53:03.000Z" itemprop="datePublished">2022-09-26</time>
</div>
    
        <div class="article-category">
        <a class="article-category-link" href="/categories/SRC/">SRC</a>
        </div>
    
    
        <div class="article-tag">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SRC/" rel="tag">SRC</a></li></ul>
        </div>
    
    </div>
</footer>

</article>

    
  
    
      <article
id="post-千锋——网络安全基础"
class="article article-type-post"
>



<div class="article-inner">
    

    <div class="article-body">
    <header class="article-title">
        <a href="/2022/1000phone/">渗透测试——千锋网络安全基础笔记</a>
    </header>
    <div class="article-entry post-inner-html">
        
        <h3 id="虚拟机VMware-Workstation"><a href="#虚拟机VMware-Workstation" class="headerlink" title="虚拟机VMware Workstation"></a>虚拟机VMware Workstation</h3><h4 id="1、安装"><a href="#1、安装" class="headerlink" title="1、安装"></a>1、安装</h4><h4 id="2、FTP服务器"><a href="#2、FTP服务器" class="headerlink" title="2、FTP服务器"></a>2、FTP服务器</h4><p>文件共享服务</p>
<p>打开我的电脑，地址栏上输入ftp://+IP地址</p>
<p>部署FTP服务器（虚拟机windows server 2012）</p>
<h4 id="局域网：一般称为内网"><a href="#局域网：一般称为内网" class="headerlink" title="局域网：一般称为内网"></a>局域网：一般称为内网</h4><p>简单局域网：交换机、网线、PC（其他IT终端）</p>
<p>交换机：用来组建内网的局域网的设备</p>
<h3 id="IP地址："><a href="#IP地址：" class="headerlink" title="IP地址："></a>IP地址：</h3><p>唯一的标识，一段网络编码，由32位组成，范围0-255，点分十进制</p>
<h3 id="子网掩码："><a href="#子网掩码：" class="headerlink" title="子网掩码："></a>子网掩码：</h3><p>局域网通信规则：在同一个局域网中，所有的IP必须在同一网段中才可以互相通信</p>
<p>IP地址构成：网络位+主机位（网路位相同的IP地址为同一网段）</p>
<p>子网掩码：用来确定IP地址的网路位</p>
<p>子网掩码如何确定网络位：与255对应的数字为网络位，与0对应的数字为主机位</p>
<p>255.0.0.0	255.255.0.0	255.255.255.0</p>
<p>一个IP地址必须配套一个子网掩码</p>
<p>当主机位全部置0代表网段，主机位全部置255代表该网段的广播地址</p>
<p>127.0.0.1 回环地址 代表本机地址 localhost</p>
<h3 id="网关："><a href="#网关：" class="headerlink" title="网关："></a>网关：</h3><p>一个网络的出口，Gateway=GW，一般网关在路由器上</p>
<p>路由器：可用连接内外网的设备</p>
<p>通信时若不在同一网段，需要发送给网关</p>
<h3 id="DNS："><a href="#DNS：" class="headerlink" title="DNS："></a>DNS：</h3><p>域名服务 Domain Name Service</p>
<p>DNS缓存</p>
<p>nslookup 命令：手工解析域名</p>
<h3 id="ping-命令："><a href="#ping-命令：" class="headerlink" title="ping 命令："></a>ping 命令：</h3><p>-t 一直ping</p>
<p>-n 数字 修改ping包的数量</p>
<p>-l 数字 修改ping包的大小</p>
<p>ipconfig 查看ip地址</p>
<p>ipconfig /all 查看DNS</p>

        
    </div>
    </div>

    <div class="article-badge">
        
        
    </div>

</div>

<footer class="article-footer">
    <div class="article-more-info">
    <div class="article-date">
  <time datetime="2022-09-12T11:20:22.000Z" itemprop="datePublished">2022-09-12</time>
</div>
    
        <div class="article-category">
        <a class="article-category-link" href="/categories/Sec/">Sec</a>
        </div>
    
    
        <div class="article-tag">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Sec/" rel="tag">Sec</a></li></ul>
        </div>
    
    </div>
</footer>

</article>

    
  
    
      <article
id="post-WUT-信息工程计网自测题"
class="article article-type-post"
>



<div class="article-inner">
    

    <div class="article-body">
    <header class="article-title">
        <a href="/2022/network/">WUT-信息工程计网自测题</a>
    </header>
    <div class="article-entry post-inner-html">
        
        <blockquote>
<p>所有资料来源于杜谦老师，此处仅作整理，方便在线浏览。</p>
<p>下方知识点汇总来源于互联网，<strong>侵删</strong>。</p>
<p>若发现错误，请及时指出并联系我修改。</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">章节</th>
<th align="center">习题</th>
<th align="center">参考答案</th>
</tr>
</thead>
<tbody><tr>
<td align="center">第一章</td>
<td align="center"><a href="https://kmoon.fun/2022/nettest1/">查看</a></td>
<td align="center"><a href="https://kmoon.fun/2022/netanswer1/">查看</a></td>
</tr>
<tr>
<td align="center">第二章</td>
<td align="center"><a href="https://kmoon.fun/2022/nettest2/">查看</a></td>
<td align="center"><a href="https://kmoon.fun/2022/netanswer2/">查看</a></td>
</tr>
<tr>
<td align="center">第三章</td>
<td align="center"><a href="https://kmoon.fun/2022/nettest3/">查看</a></td>
<td align="center"><a href="https://kmoon.fun/2022/netanswer3/">查看</a></td>
</tr>
<tr>
<td align="center">第四章</td>
<td align="center"><a href="https://kmoon.fun/2022/nettest4/">查看</a></td>
<td align="center"><a href="https://kmoon.fun/2022/netanswer4/">查看</a></td>
</tr>
<tr>
<td align="center">第五章</td>
<td align="center"><a href="https://kmoon.fun/2022/nettest5/">查看</a></td>
<td align="center"><a href="https://kmoon.fun/2022/netanswer5/">查看</a></td>
</tr>
<tr>
<td align="center">第六章</td>
<td align="center"><a href="https://kmoon.fun/2022/nettest6/">查看</a></td>
<td align="center"><a href="https://kmoon.fun/2022/netanswer6/">查看</a></td>
</tr>
<tr>
<td align="center">第七章</td>
<td align="center"><a href="https://kmoon.fun/2022/nettest7/">查看</a></td>
<td align="center"><a href="https://kmoon.fun/2022/netanswer7/">查看</a></td>
</tr>
<tr>
<td align="center">第八章</td>
<td align="center"><a href="https://kmoon.fun/2022/nettest8/">查看</a></td>
<td align="center"><a href="https://kmoon.fun/2022/netanswer8/">查看</a></td>
</tr>
<tr>
<td align="center">第九章</td>
<td align="center"><a href="https://kmoon.fun/2022/nettest9/">查看</a></td>
<td align="center"><a href="https://kmoon.fun/2022/netanswer9/">查看</a></td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th align="left">计算机网络谢希仁第7版知识点汇总</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><a href="https://www.cnblogs.com/shixiaomaa/p/10263778.html">博客园</a></td>
</tr>
<tr>
<td align="left"><a href="https://blog.csdn.net/qq_42468130/article/details/82760291">CSDN</a></td>
</tr>
</tbody></table>

        
    </div>
    </div>

    <div class="article-badge">
        
        
    </div>

</div>

<footer class="article-footer">
    <div class="article-more-info">
    <div class="article-date">
  <time datetime="2022-09-11T02:47:27.748Z" itemprop="datePublished">2022-09-11</time>
</div>
    
        <div class="article-category">
        <a class="article-category-link" href="/categories/Whut/">Whut</a>
        </div>
    
    
        <div class="article-tag">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AE%A1%E7%BD%91/" rel="tag">计网</a></li></ul>
        </div>
    
    </div>
</footer>

</article>

    
  
    
      <article
id="post-学习札记-C++程序设计"
class="article article-type-post"
>



<div class="article-inner">
    

    <div class="article-body">
    <header class="article-title">
        <a href="/2022/study-c/">学习札记-C++程序设计</a>
    </header>
    <div class="article-entry post-inner-html">
        
        <p>2022年9月开始学习C++程序设计基础内容，学习ing~</p>
<p><strong>第〇章 C++语法</strong></p>
<p><em><span class="underline">基础语法跳过</span></em></p>
<p><strong>变量，常量</strong></p>
<p>变量方便我们管理内存空间</p>
<p>宏常量：#define 常量名 常量值</p>
<p>const修饰的变量：const 数据类型 变量名 = 变量值;</p>
<p><strong>关键字（标识符）</strong></p>
<p><img src="/%E5%AD%A6%E4%B9%A0%E6%9C%AD%E8%AE%B0-C++%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image1.png" alt="截图.png">{width=”5.666666666666667in” height=”3.6545111548556433in”}</p>
<p><strong>数据类型</strong></p>
<p>数据类型的意义是给变量分配合适的内存空间，避免空间浪费</p>
<p><img src="/%E5%AD%A6%E4%B9%A0%E6%9C%AD%E8%AE%B0-C++%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image2.png" alt="截图.png">{width=”5.694444444444445in” height=”1.6355807086614174in”}</p>
<p><strong>sizeof关键字</strong>：统计数据类型所占内存大小 sizeof (数据类型/变量);</p>
<p>float f1 = 3.14f;</p>
<p>默认情况下，输出一个小数会显示6位有效数字</p>
<p><img src="/%E5%AD%A6%E4%B9%A0%E6%9C%AD%E8%AE%B0-C++%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/image3.png" alt="截图.png">{width=”5.694444444444445in” height=”0.9211603237095363in”}</p>
<p><strong>字符型</strong>：char 用于显示<strong>单个字符</strong>，用<strong>单引号</strong>将字符括起来，不可以使用双引号，字符型变量对应ASCII编码 a-97 A-65 0-48</p>
<p>可以直接用ASCII码给字符型变量赋值</p>
<p><strong>字符串型</strong>：string 变量名 = "字符串值"</p>
<p>需要包含头文件 #include &lt;string&gt;</p>
<p><strong>布尔类型：</strong>bool 变量名 = true/false;</p>
<p><strong>数据的输入</strong></p>
<p>cin关键字：cin &gt;&gt; 变量</p>
<p><strong>程序流程结构</strong></p>
<p>1.选择结构 <strong>if语句</strong></p>
<p>2.循环结构 <strong>for语句 while语句 switch语句</strong></p>
<p><strong>goto语句：</strong></p>
<p>goto FLAG;</p>
<p>FLAG:</p>
<p><strong>数组</strong></p>
<p>一维数组和二维数组</p>
<p>数组定义的方式</p>
<p><strong>函数</strong></p>
<p>函数的分文件编写：</p>
<p>1、创建.h头文件</p>
<p>2、创建.cppu源文件</p>
<p>3、在头文件中写函数的声明</p>
<p>4、在源文件中写函数的定义</p>
<p><strong>指针</strong></p>
<p>指针：一个保存地址的变量</p>
<p>通过<strong>解引用</strong>来找到指针指向的内存：指针前加 * 表示解引用</p>
<p><strong>空指针</strong>：指针变量指向内存中编号为0的空间 用于<strong>初始化指针变量</strong></p>
<p>注意空指针指向的内存是不可以访问的,内存编号0-255为系统占用，不允许用户访问</p>
<p>int * p= NULL;</p>
<p><strong>野指针</strong>：指针变量指向<strong>非法</strong>的内存空间</p>
<p><strong>const修饰指针</strong></p>
<p>1、const修饰指针：<strong>常量指针</strong> const int * p=a;</p>
<p><strong>指针的指向可改，指向的值不可改</strong></p>
<p>2、const修饰常量：<strong>指针常量</strong> int * const p = &amp;a;</p>
<p><strong>指针的指向不可改，指向的值可改</strong></p>
<p>3、const既修饰指针又修饰常量 const int * const p=a;</p>
<p><strong>指针的指向不可改，指向的值不可改</strong></p>
<p><strong>指针和数组</strong></p>
<p><strong>指针和函数</strong></p>
<p><strong>结构体</strong></p>
<p>结构体的定义</p>
<p>结构体数组</p>
<p>结构体指针：利用**操作符-&gt;**可以通过结构体指针访问结构体的属性 p-&gt;属性名</p>
<p>结构体嵌套结构体：注意声明顺序</p>
<p>结构体做函数参数</p>
<p>结构体中const使用场景：防止函数误操作（常量指针）</p>
<p><strong>第一章 从C到C++</strong></p>
<p><strong>内存分区模型</strong></p>
<p>C++程序在执行时，将内存大方向划分为<strong>4个区域</strong></p>
<p><strong>代码区</strong>：存放函数体的<strong>二进制代码</strong>，由操作系统进行管理的</p>
<p><strong>全局区</strong>：存放全局变量和静态变量以及常量</p>
<p><strong>栈区</strong>：由编译器自动分配释放，存放函数的<strong>参数值，局部变量</strong>等</p>
<p><strong>堆区</strong>：由程序员分配和释放，若程序员不释放，程序结束时由操作系统回收</p>
<p><strong>内存四区的意义：</strong></p>
<p>不同的区域存放的数据，赋予不同的<strong>生命周期</strong>，给我们更大的灵活编程</p>
<p><strong>1.1 程序运行前</strong></p>
<p>在程序编译后，生成了exe可执行程序，<strong>未执行该程序前</strong>分为两个区域</p>
<p><strong>代码区：</strong></p>
<p>存放CPU执行的机械指令</p>
<p>代码区是<strong>共享</strong>的，共享的目的是对于频繁被执行的程序，只需要在内存中有一份代码即可</p>
<p>代码区是<strong>只读</strong>的，使其只读的原因是防止程序意外地修改了它的指令</p>
<p><strong>全局区</strong></p>
<p>存放<strong>全局变量</strong>和<strong>静态变量</strong></p>
<p>全局变量还包括常量区，存放字符串常量和const修饰的全局常量</p>
<p>该区域的数据在程序结束后由操作系统释放</p>
<p>总结：</p>
<p>C++在程序运行前分为全局区和代码区</p>
<p>代码区特点是共享和只读</p>
<p>局部变量、const修饰的局部变量不在全局区</p>
<p>全局变量、静态变量（static）、常量（字符串常量、const修饰的全局变量）在全局区</p>
<p><strong>1.2 程序运行后</strong></p>
<p><strong>栈区：</strong></p>
<p>由编译器自动分配释放，存放函数的参数值，局部变量等</p>
<p><strong>注意</strong>：不要返回局部变量的地址，<strong>栈区</strong>开辟的数据由编译器<strong>自动释放</strong></p>
<p>总结：</p>
<p>编译器只会保存一次局部变量的地址</p>
<p><strong>堆区：</strong></p>
<p>由程序员分配释放，若程序员不释放，程序结束时由操作系统释放</p>
<p>在C++中主要利用<strong>new</strong>在堆区开辟内存</p>
<p>int *p = new int(10)</p>
<p>总结：</p>
<p>堆区数据由程序员管理开辟和释放</p>
<p>堆区数据利用new关键字进行开辟内存</p>
<p><strong>1.3 new操作符</strong></p>
<p>释放利用操作符<strong>delete</strong></p>
<p>语法：new 数据类型() 开辟数组 new 数据类型[num]</p>
<p>new返回的是该数据类型的指针</p>
<p>释放堆区数组：<strong>delete[] arry</strong></p>
<p><strong>引用</strong></p>
<p><strong>2.1 基本使用</strong></p>
<p><strong>作用</strong>：给变量起别名</p>
<p><strong>语法</strong>：<strong>数据类型 &amp;别名 = 原名</strong></p>
<p>数据类型要一致</p>
<p><strong>2.2 注意事项</strong></p>
<p>引用必须初始化：声明是谁的别名</p>
<p>引用在初始化后，不可以更改引用，注意区别更改引用和赋值操作</p>
<p><strong>2.3 引用做函数参数</strong></p>
<p><strong>作用：</strong>函数传参时，可以利用引用的技术让形参修饰实参</p>
<p><strong>优点：</strong>可以简化指针修改实参</p>
<p>值传递：形参不会修饰实参</p>
<p>地址传递：&amp;取址符 指针接收地址 形参会修饰实参</p>
<p>引用传递：利用引用的方式接收数据 形参会修饰实参</p>
<p><strong>2.4 引用做函数返回值</strong></p>
<p>作用：引用是可以作为函数返回值的</p>
<p>不要返回局部变量的引用</p>
<p>函数的调用可以作为左值</p>
<p><strong>2.5 引用的本质</strong></p>
<p>本质：<strong>引用的本质在C++内部实现是一个指针常量</strong></p>
<p><strong>指针常量</strong>：该指针是常量，是一个指向不可改，值可改的指针</p>
<p><strong>常量指针</strong>：指向常量的指针，是一个指向可改，值不可改的指针</p>
<p>int* const ref = &amp;a;</p>
<p><strong>2.6 常量引用</strong></p>
<p>作用：常量引用主要用于修饰形参，防止误操作</p>
<p>const int &amp; a = 10;</p>
<p>在函数形参列表中，可以加const修饰形参，防止形参改变实参</p>
<p>引用必须引一块合法的内存空间，不能引常量区</p>
<p>const修饰后变为只读，不可以修改</p>
<p><strong>第二章 类和对象初步</strong></p>
<p><strong>第三章 类和对象进阶（实验）</strong></p>
<p><strong>第四章 运算符重载（实验）</strong></p>
<p><strong>第五章 继承和派生（实验）</strong></p>
<p><strong>第六章 多态与虚函数</strong></p>
<p><strong>第七章 输入输出流（实验）</strong></p>
<p><strong>第八章 C++文件操作</strong></p>
<p><strong>第九章 泛型程序设计与模块</strong></p>
<p><strong>第十章 标准模块库STL</strong></p>

        
    </div>
    </div>

    <div class="article-badge">
        
        
    </div>

</div>

<footer class="article-footer">
    <div class="article-more-info">
    <div class="article-date">
  <time datetime="2022-09-03T07:39:25.000Z" itemprop="datePublished">2022-09-03</time>
</div>
    
        <div class="article-category">
        <a class="article-category-link" href="/categories/%E5%AD%A6%E4%B9%A0%E6%9C%AD%E8%AE%B0/">学习札记</a>
        </div>
    
    
        <div class="article-tag">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C/" rel="tag">C++</a></li></ul>
        </div>
    
    </div>
</footer>

</article>

    
  
    
      <article
id="post-懒人必备—WUT-AutoHealthyReport"
class="article article-type-post"
>



<div class="article-inner">
    

    <div class="article-body">
    <header class="article-title">
        <a href="/2022/wut-autohealthyreport/">懒人必备—WUT-AutoHealthyReport</a>
    </header>
    <div class="article-entry post-inner-html">
        
        <p>Talk is cheap,Show me the code.</p>
<p>通过访问学校健康填报接口，模拟本科生健康填报过程。</p>
<p>并且通过cqhttp发送结果到QQ(群)号。（支持多用户批量填报）</p>
<p>通过部署到Linux云服务器，通过crontab设置定时任务，实现每天定时填报。</p>
<h3 id="免责声明"><a href="#免责声明" class="headerlink" title="免责声明"></a>免责声明</h3><p>该自动填报程序仅为了方便每日填报过程，<strong>严禁</strong>通过该程序伪造填报地址、瞒报健康状态。</p>
<p>若身体不适请及时报告并就医，<strong>严格遵守疫情防控相关规定</strong>！</p>
<p><strong>若使用该程序导致不良后果，本文作者不承担任何责任，使用者需承担所有责任！</strong></p>
<p>若没有python编程基础，请勿贸然使用程序，可能导致账号绑定在别处自己无法登录无法登录。</p>
<p>打包版程序可以参考GitHub作者ChrisKimZHT部署使用。</p>
<h3 id="快速开始"><a href="#快速开始" class="headerlink" title="快速开始"></a>快速开始</h3><ol>
<li><p>确保系统有 <code>Python3</code> 环境。</p>
<p>python安装、环境变量配置自行百度。</p>
<p>参考链接：<a href="https://www.runoob.com/python/python-install.html">https://www.runoob.com/python/python-install.html</a></p>
</li>
<li><p>安装模块：<code>pip install 库名</code></p>
<p>或者pip install -r requirements.txt</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">//</span>需要用到的python库：
time
logging
json
base64
random
requests<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>首次运行 <code>whut.py</code>，需要提前填写相关信息。<strong>请注意地址和在校情况的填写，尤其是假期。</strong></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">//</span>data_student数组，存放学生基本信息和填报信息
data_student<span class="token operator">=</span><span class="token punctuation">[</span>
<span class="token punctuation">{</span><span class="token string">'account'</span><span class="token punctuation">:</span> <span class="token string">'0122xxxxxxxxx'</span><span class="token punctuation">,</span>	<span class="token operator">//</span>学号
 <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'xxxxxx'</span><span class="token punctuation">,</span>	  <span class="token operator">//</span>密码，一般为身份证后六位
 <span class="token string">'province'</span><span class="token punctuation">:</span> <span class="token string">'湖北省'</span><span class="token punctuation">,</span>
 <span class="token string">'city'</span><span class="token punctuation">:</span> <span class="token string">'武汉市'</span><span class="token punctuation">,</span>
 <span class="token string">'county'</span><span class="token punctuation">:</span> <span class="token string">'洪山区'</span><span class="token punctuation">,</span>
 <span class="token string">'street'</span><span class="token punctuation">:</span> <span class="token string">'岭南路'</span><span class="token punctuation">,</span>		<span class="token operator">//</span>example
 <span class="token string">'is_inschool'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>	<span class="token operator">//</span>是否在校
 <span class="token string">'is_leacecity'</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">,</span>	<span class="token operator">//</span>是否离汉
 <span class="token string">'temperature'</span><span class="token punctuation">:</span> <span class="token string">'36.5°C~36.9°C'</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>在 <code>whut.py</code> 目录下，在cmd中执行 <code>python whut.py</code> 即可运行程序。</p>
</li>
<li><p>定时运行 <code>whut.py</code> 即可自动填报（Linux服务器 可用 <code>Crontab</code> 定时执行, Windows 参考相关链接）</p>
</li>
</ol>
<h3 id="代码详解"><a href="#代码详解" class="headerlink" title="代码详解"></a>代码详解</h3><h5 id="日志记录"><a href="#日志记录" class="headerlink" title="日志记录"></a>日志记录</h5><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 创建log日志</span>
log <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span><span class="token string">"log.txt"</span><span class="token punctuation">)</span>
log<span class="token punctuation">.</span>setLevel<span class="token punctuation">(</span>logging<span class="token punctuation">.</span>DEBUG<span class="token punctuation">)</span>
<span class="token comment"># 控制台输出Handler</span>
shandler <span class="token operator">=</span> logging<span class="token punctuation">.</span>StreamHandler<span class="token punctuation">(</span><span class="token punctuation">)</span>
shandler<span class="token punctuation">.</span>setFormatter<span class="token punctuation">(</span>logging<span class="token punctuation">.</span>Formatter<span class="token punctuation">(</span><span class="token string">"[%(levelname)s] %(message)s"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
shandler<span class="token punctuation">.</span>setLevel<span class="token punctuation">(</span>logging<span class="token punctuation">.</span>INFO<span class="token punctuation">)</span>
<span class="token comment"># 文件输出Handler</span>
fhandler <span class="token operator">=</span> logging<span class="token punctuation">.</span>FileHandler<span class="token punctuation">(</span>filename<span class="token operator">=</span><span class="token string">"log.txt"</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">"w"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span>
fhandler<span class="token punctuation">.</span>setFormatter<span class="token punctuation">(</span>logging<span class="token punctuation">.</span>Formatter<span class="token punctuation">(</span><span class="token string">"&lt;%(asctime)s&gt; [%(levelname)s] %(message)s"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
fhandler<span class="token punctuation">.</span>setLevel<span class="token punctuation">(</span>logging<span class="token punctuation">.</span>DEBUG<span class="token punctuation">)</span>
<span class="token comment"># 添加Handler</span>
log<span class="token punctuation">.</span>addHandler<span class="token punctuation">(</span>shandler<span class="token punctuation">)</span>
log<span class="token punctuation">.</span>addHandler<span class="token punctuation">(</span>fhandler<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="请求数据包随机User-Agent"><a href="#请求数据包随机User-Agent" class="headerlink" title="请求数据包随机User-Agent"></a>请求数据包随机User-Agent</h5><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">//</span>分别为Android、iPhone、Windows
ua_list <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">"Mozilla/5.0 (Linux; Android 8.0.0; BKL-AL00 Build/HUAWEIBKL-AL00; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/76.0.3809.89 Mobile Safari/537.36 T7/11.19 SP-engine/2.15.0 baiduboxapp/11.19.5.10 (Baidu; P1 8.0.0)"</span><span class="token punctuation">,</span>
    <span class="token string">"Mozilla/5.0 (Linux; Android 8.1.0; vivo X20 Build/OPM1.171019.011; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/76.0.3809.89 Mobile Safari/537.36 T7/11.19 SP-engine/2.15.0 baiduboxapp/11.19.5.10 (Baidu; P1 8.1.0)"</span><span class="token punctuation">,</span>
    <span class="token string">"Mozilla/5.0 (Linux; Android 9; DUK-AL20 Build/HUAWEIDUK-AL20; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/76.0.3809.89 Mobile Safari/537.36 T7/11.19 SP-engine/2.15.0 baiduboxapp/11.19.5.10 (Baidu; P1 9)"</span><span class="token punctuation">,</span>
    <span class="token string">"Mozilla/5.0 (Linux; Android 11; POCO F2 Pro Build/RKQ1.200826.002; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/74.0.3729.136 Mobile Safari/537.36 MMWEBID/1230 MicroMessenger/8.0.17.2040(0x28001133) Process/toolsmp WeChat/arm64 Weixin NetType/WIFI Language/zh_CN ABI/arm64"</span><span class="token punctuation">,</span>
    <span class="token string">"Mozilla/5.0 (iPhone; CPU iPhone OS 15_4_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 MicroMessenger/8.0.20(0x1800142f) NetType/WIFI Language/zh_CN"</span><span class="token punctuation">,</span>
    <span class="token string">"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.143 Safari/537.36 MicroMessenger/7.0.9.501 NetType/WIFI MiniProgramEnv/Windows WindowsWechat"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="HTTP请求头"><a href="#HTTP请求头" class="headerlink" title="HTTP请求头"></a>HTTP请求头</h5><pre class="line-numbers language-python" data-language="python"><code class="language-python">headers <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">"Host"</span><span class="token punctuation">:</span> <span class="token string">"zhxg.whut.edu.cn"</span><span class="token punctuation">,</span>		<span class="token operator">//</span>主机域名
    <span class="token string">"Connection"</span><span class="token punctuation">:</span> <span class="token string">"keep-alive"</span><span class="token punctuation">,</span>
    <span class="token comment"># "Content-Length": "",</span>
    <span class="token comment"># "User-Agent": "",</span>
    <span class="token string">"X-Tag"</span><span class="token punctuation">:</span> <span class="token string">"flyio"</span><span class="token punctuation">,</span>
    <span class="token string">"content-type"</span><span class="token punctuation">:</span> <span class="token string">"application/json"</span><span class="token punctuation">,</span>
    <span class="token string">"encode"</span><span class="token punctuation">:</span> <span class="token string">"true"</span><span class="token punctuation">,</span>
    <span class="token string">"Referer"</span><span class="token punctuation">:</span> <span class="token string">"https://servicewechat.com/wxa0738e54aae84423/21/page-frame.html"</span><span class="token punctuation">,</span>
    <span class="token string">"Accept-Encoding"</span><span class="token punctuation">:</span> <span class="token string">"gzip, deflate, br"</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="获取SessionID凭证"><a href="#获取SessionID凭证" class="headerlink" title="获取SessionID凭证"></a>获取SessionID凭证</h5><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">check_bind</span><span class="token punctuation">(</span>is_graduate<span class="token punctuation">:</span> <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> error_log
    log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"[1] 正在创建会话"</span><span class="token punctuation">)</span>
    <span class="token comment"># 设置header</span>
	url <span class="token operator">=</span> <span class="token string">"https://zhxg.whut.edu.cn/yqtjwx/api/login/checkBind"</span>
    headers<span class="token punctuation">[</span><span class="token string">"User-Agent"</span><span class="token punctuation">]</span> <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>ua_list<span class="token punctuation">)</span>
    log<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"设置header完成: </span><span class="token interpolation"><span class="token punctuation">{</span>headers<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> dict_to_base64_bin<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"sn"</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token string">"idCard"</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    respounce <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>
    log<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"请求发送完成，收到响应: </span><span class="token interpolation"><span class="token punctuation">{</span>respounce<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> respounce<span class="token punctuation">[</span><span class="token string">"status"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        resp_data <span class="token operator">=</span> base64_str_to_dict<span class="token punctuation">(</span>respounce<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        log<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"响应data解码: </span><span class="token interpolation"><span class="token punctuation">{</span>resp_data<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        headers<span class="token punctuation">[</span><span class="token string">"Cookie"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"JSESSIONID=</span><span class="token interpolation"><span class="token punctuation">{</span>resp_data<span class="token punctuation">[</span><span class="token string">'sessionId'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>  <span class="token comment"># 写入Cookie</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        error_log <span class="token operator">+=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>respounce<span class="token punctuation">)</span>
        log<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">"[X] 创建会话出现错误，详情见log.txt"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="绑定身份"><a href="#绑定身份" class="headerlink" title="绑定身份"></a>绑定身份</h5><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">bind_user_info</span><span class="token punctuation">(</span>account<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> password<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> is_graduate<span class="token punctuation">:</span> <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> error_log
    log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"[2] 正在绑定身份"</span><span class="token punctuation">)</span>
	url <span class="token operator">=</span> <span class="token string">"https://zhxg.whut.edu.cn/yqtjwx/api/login/bindUserInfo"</span>
    data <span class="token operator">=</span> dict_to_base64_bin<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"sn"</span><span class="token punctuation">:</span> account<span class="token punctuation">,</span> <span class="token string">"idCard"</span><span class="token punctuation">:</span> password<span class="token punctuation">}</span><span class="token punctuation">)</span>
    respounce <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>
    log<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"请求发送完成，收到响应: </span><span class="token interpolation"><span class="token punctuation">{</span>respounce<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> respounce<span class="token punctuation">[</span><span class="token string">"status"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        resp_data <span class="token operator">=</span> base64_str_to_dict<span class="token punctuation">(</span>respounce<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        log<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"响应data解码: </span><span class="token interpolation"><span class="token punctuation">{</span>resp_data<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        error_log <span class="token operator">+=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>respounce<span class="token punctuation">)</span>
        log<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">"[X] 绑定身份出现错误，详情见log.txt"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="健康填报"><a href="#健康填报" class="headerlink" title="健康填报"></a>健康填报</h5><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">monitor_register</span><span class="token punctuation">(</span>is_graduate<span class="token punctuation">:</span> <span class="token builtin">bool</span><span class="token punctuation">,</span> province<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> city<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> county<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> street<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span>is_inschool<span class="token punctuation">:</span> <span class="token builtin">bool</span><span class="token punctuation">,</span> is_leavecity<span class="token punctuation">:</span> <span class="token builtin">bool</span><span class="token punctuation">,</span> temperature<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> error_log
    log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"[3] 正在填报操作"</span><span class="token punctuation">)</span>
    address <span class="token operator">=</span> province <span class="token operator">+</span> city <span class="token operator">+</span> county <span class="token operator">+</span> street
	url <span class="token operator">=</span> <span class="token string">"https://zhxg.whut.edu.cn/yqtjwx/./monitorRegister"</span>
    dict_data <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">"diagnosisName"</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
        <span class="token string">"relationWithOwn"</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
        <span class="token string">"currentAddress"</span><span class="token punctuation">:</span> address<span class="token punctuation">,</span>
        <span class="token string">"remark"</span><span class="token punctuation">:</span> <span class="token string">"无"</span><span class="token punctuation">,</span>
        <span class="token string">"healthInfo"</span><span class="token punctuation">:</span> <span class="token string">"正常"</span><span class="token punctuation">,</span>
        <span class="token string">"isDiagnosis"</span><span class="token punctuation">:</span> <span class="token string">"0"</span><span class="token punctuation">,</span>
        <span class="token string">"isFever"</span><span class="token punctuation">:</span> <span class="token string">"0"</span><span class="token punctuation">,</span>
        <span class="token string">"isInSchool"</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>is_inschool<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">"isLeaveChengdu"</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>is_leavecity<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">"isSymptom"</span><span class="token punctuation">:</span> <span class="token string">"0"</span><span class="token punctuation">,</span>
        <span class="token string">"temperature"</span><span class="token punctuation">:</span> temperature<span class="token punctuation">,</span>
        <span class="token string">"province"</span><span class="token punctuation">:</span> province<span class="token punctuation">,</span>
        <span class="token string">"city"</span><span class="token punctuation">:</span> city<span class="token punctuation">,</span>
        <span class="token string">"county"</span><span class="token punctuation">:</span> county
    <span class="token punctuation">}</span>
    log<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"填报数据生成完成: </span><span class="token interpolation"><span class="token punctuation">{</span>dict_data<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> dict_to_base64_bin<span class="token punctuation">(</span>dict_data<span class="token punctuation">)</span>
    respounce <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>
    log<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"请求发送完成，收到响应: </span><span class="token interpolation"><span class="token punctuation">{</span>respounce<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> respounce<span class="token punctuation">[</span><span class="token string">"status"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        resp_data <span class="token operator">=</span> base64_str_to_dict<span class="token punctuation">(</span>respounce<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        log<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"响应data解码: </span><span class="token interpolation"><span class="token punctuation">{</span>resp_data<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> respounce<span class="token punctuation">[</span><span class="token string">"message"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'今日已填报'</span><span class="token punctuation">:</span>
            <span class="token keyword">global</span> reported
            reported<span class="token operator">=</span> <span class="token boolean">True</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            error_log <span class="token operator">+=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>respounce<span class="token punctuation">)</span>
            log<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">"[X] 填报操作出现错误，详情见log.txt"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="解绑账号"><a href="#解绑账号" class="headerlink" title="解绑账号"></a>解绑账号</h5><p>若不解绑，下次填报将无法成功绑定。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">cancel_bind</span><span class="token punctuation">(</span>is_graduate<span class="token punctuation">:</span> <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> error_log
    log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"[4] 正在解绑身份"</span><span class="token punctuation">)</span>
    url <span class="token operator">=</span> <span class="token string">"https://zhxg.whut.edu.cn/yqtjwx/api/login/cancelBind"</span>
    respounce <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span><span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>
    log<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"请求发送完成，收到响应: </span><span class="token interpolation"><span class="token punctuation">{</span>respounce<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> respounce<span class="token punctuation">[</span><span class="token string">"status"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        resp_data <span class="token operator">=</span> base64_str_to_dict<span class="token punctuation">(</span>respounce<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        log<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"响应data解码: </span><span class="token interpolation"><span class="token punctuation">{</span>resp_data<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        error_log <span class="token operator">+=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>respounce<span class="token punctuation">)</span>
        log<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">"[X] 解绑身份出现错误，详情见log.txt"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="数据包加解密"><a href="#数据包加解密" class="headerlink" title="数据包加解密"></a>数据包加解密</h5><p>数据包post提交的json格式的数据，经base64加密传输，所以我们发送数据需要加密，接受数据需要解密。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">//</span>加密
<span class="token keyword">def</span> <span class="token function">dict_to_base64_bin</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span> <span class="token builtin">dict</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bin</span><span class="token punctuation">:</span>
    string <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    binary <span class="token operator">=</span> string<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>
    base64_binary <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>binary<span class="token punctuation">)</span>
    <span class="token keyword">return</span> base64_binary
<span class="token operator">//</span>解密
<span class="token keyword">def</span> <span class="token function">base64_str_to_dict</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">dict</span><span class="token punctuation">:</span>
    string_binary <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    string <span class="token operator">=</span> string_binary<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>
    dictionary <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>string<span class="token punctuation">)</span>
    <span class="token keyword">return</span> dictionary<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="填报程序"><a href="#填报程序" class="headerlink" title="填报程序"></a>填报程序</h5><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">//</span>单次填报
<span class="token keyword">def</span> <span class="token function">report</span><span class="token punctuation">(</span>account<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> password<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> is_graduate<span class="token punctuation">:</span> <span class="token builtin">bool</span><span class="token punctuation">,</span>
           province<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> city<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> county<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> street<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span>
           is_inschool<span class="token punctuation">:</span> <span class="token builtin">bool</span><span class="token punctuation">,</span> is_leacecity<span class="token punctuation">:</span> <span class="token builtin">bool</span><span class="token punctuation">,</span> temperature<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">tuple</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> error_log
    log<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"开始填报: </span><span class="token interpolation"><span class="token punctuation">{</span>account<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    status <span class="token operator">=</span> <span class="token boolean">True</span>  <span class="token comment"># 填报状态</span>
    headers<span class="token punctuation">[</span><span class="token string">"Cookie"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">""</span>  <span class="token comment"># 重置headers</span>
    error_log <span class="token operator">=</span> <span class="token string">""</span>  <span class="token comment"># 重置错误日志</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token punctuation">(</span>check_bind<span class="token punctuation">(</span>is_graduate<span class="token punctuation">)</span> <span class="token keyword">and</span>
                bind_user_info<span class="token punctuation">(</span>account<span class="token punctuation">,</span> password<span class="token punctuation">,</span> is_graduate<span class="token punctuation">)</span> <span class="token keyword">and</span>
                monitor_register<span class="token punctuation">(</span>is_graduate<span class="token punctuation">,</span> province<span class="token punctuation">,</span> city<span class="token punctuation">,</span> county<span class="token punctuation">,</span> street<span class="token punctuation">,</span> is_inschool<span class="token punctuation">,</span> is_leacecity<span class="token punctuation">,</span> temperature<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            status <span class="token operator">=</span> <span class="token boolean">False</span>
    <span class="token keyword">finally</span><span class="token punctuation">:</span>
        status <span class="token operator">&amp;</span><span class="token operator">=</span> cancel_bind<span class="token punctuation">(</span>is_graduate<span class="token punctuation">)</span>
    <span class="token keyword">if</span> status<span class="token punctuation">:</span>
        <span class="token keyword">if</span> reported<span class="token punctuation">:</span>
            log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"------今日已填报，别操心啦------"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f" </span><span class="token interpolation"><span class="token punctuation">{</span>account<span class="token punctuation">}</span></span><span class="token string"> 今日已填报！"</span></span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>account<span class="token punctuation">}</span></span><span class="token string">填报成功"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f" </span><span class="token interpolation"><span class="token punctuation">{</span>account<span class="token punctuation">}</span></span><span class="token string"> 填报成功！"</span></span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        log<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>account<span class="token punctuation">}</span></span><span class="token string">填报失败"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f" </span><span class="token interpolation"><span class="token punctuation">{</span>account<span class="token punctuation">}</span></span><span class="token string"> 填报失败！\n"</span></span> <span class="token operator">+</span> error_log

<span class="token operator">//</span>批量填报
<span class="token keyword">def</span> <span class="token function">report_by_dict</span><span class="token punctuation">(</span>user<span class="token punctuation">:</span> <span class="token builtin">dict</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">tuple</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> report<span class="token punctuation">(</span>user<span class="token punctuation">[</span><span class="token string">"account"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> user<span class="token punctuation">[</span><span class="token string">"password"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> user<span class="token punctuation">[</span><span class="token string">"is_graduate"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                  user<span class="token punctuation">[</span><span class="token string">"province"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> user<span class="token punctuation">[</span><span class="token string">"city"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> user<span class="token punctuation">[</span><span class="token string">"county"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> user<span class="token punctuation">[</span><span class="token string">"street"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                  user<span class="token punctuation">[</span><span class="token string">"is_inschool"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> user<span class="token punctuation">[</span><span class="token string">"is_leacecity"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> user<span class="token punctuation">[</span><span class="token string">"temperature"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="go-cqhttp配置"><a href="#go-cqhttp配置" class="headerlink" title="go-cqhttp配置"></a>go-cqhttp配置</h5><p>这部分只是进行信息反馈的作用，告知你每天是否成功填报。</p>
<p>若你不知道go-cqhttp或不想启用它可以跳过。</p>
<p>参考文档：<a href="https://github.com/Mrs4s/go-cqhttp">https://github.com/Mrs4s/go-cqhttp</a></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 正确配置并启用后，每次填报后程序会发送QQ消息到对应收信QQ号或QQ群。</span>
cqhttp <span class="token operator">=</span> conf_notification<span class="token punctuation">[</span><span class="token string">"cqhttp"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"enable"</span><span class="token punctuation">]</span>  <span class="token comment"># 是否启用go-cqhttp发信</span>
api <span class="token operator">=</span> conf_notification<span class="token punctuation">[</span><span class="token string">"cqhttp"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"api"</span><span class="token punctuation">]</span>  <span class="token comment"># cqhttp http API 地址</span>
uid <span class="token operator">=</span> conf_notification<span class="token punctuation">[</span><span class="token string">"cqhttp"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"uid"</span><span class="token punctuation">]</span>  <span class="token comment"># 收信QQ号，不填则不发送</span>
gid <span class="token operator">=</span> conf_notification<span class="token punctuation">[</span><span class="token string">"cqhttp"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"gid"</span><span class="token punctuation">]</span>  <span class="token comment"># 收信群号，不填则不发送</span>

<span class="token keyword">def</span> <span class="token function">msg</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> cqhttp<span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            send_cqhttp<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
            log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"成功发送cqhttp消息"</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            log<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">"发送cqhttp消息失败"</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"未启用cqhttp推送"</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">send_cqhttp</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
    data_user <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">"user_id"</span><span class="token punctuation">:</span> uid<span class="token punctuation">,</span>		<span class="token operator">//</span>QQ号
        <span class="token string">"message"</span><span class="token punctuation">:</span> text
    <span class="token punctuation">}</span>
    data_group <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">"group_id"</span><span class="token punctuation">:</span> xxxxxxx<span class="token punctuation">,</span>	<span class="token operator">//</span>QQ群号
        <span class="token string">"message"</span><span class="token punctuation">:</span> text
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> data_user<span class="token punctuation">[</span><span class="token string">"user_id"</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">""</span><span class="token punctuation">:</span>
        requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>api<span class="token punctuation">,</span> params<span class="token operator">=</span>data_user<span class="token punctuation">)</span>
    <span class="token keyword">if</span> data_group<span class="token punctuation">[</span><span class="token string">"group_id"</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">""</span><span class="token punctuation">:</span>
        requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'http://youripaddres:5700/send_group_msg'</span><span class="token punctuation">,</span> params<span class="token operator">=</span>data_group<span class="token punctuation">)</span>
        <span class="token operator">//</span>注意API地址填写正确<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="填报程序入口"><a href="#填报程序入口" class="headerlink" title="填报程序入口"></a>填报程序入口</h5><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">//</span>whut<span class="token punctuation">.</span>py

data_student<span class="token operator">=</span><span class="token punctuation">[</span>
<span class="token punctuation">{</span><span class="token string">'account'</span><span class="token punctuation">:</span> <span class="token string">'0122xxxxxxxx'</span><span class="token punctuation">,</span>
 <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'xxxxxx'</span><span class="token punctuation">,</span>
 <span class="token string">'province'</span><span class="token punctuation">:</span> <span class="token string">'湖北省'</span><span class="token punctuation">,</span>
 <span class="token string">'city'</span><span class="token punctuation">:</span> <span class="token string">'武汉市'</span><span class="token punctuation">,</span>
 <span class="token string">'county'</span><span class="token punctuation">:</span> <span class="token string">'洪山区'</span><span class="token punctuation">,</span>
 <span class="token string">'street'</span><span class="token punctuation">:</span> <span class="token string">'岭南路'</span><span class="token punctuation">,</span>
 <span class="token string">'is_inschool'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
 <span class="token string">'is_leacecity'</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">,</span>
 <span class="token string">'temperature'</span><span class="token punctuation">:</span> <span class="token string">'36.5°C~36.9°C'</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"======程序启动======="</span><span class="token punctuation">)</span>
    message <span class="token operator">=</span> <span class="token string">"[健康填报-自动反馈]\n"</span>
    <span class="token keyword">for</span> user <span class="token keyword">in</span> data_student<span class="token punctuation">:</span>
        text <span class="token operator">=</span> <span class="token string">""</span>
        log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"===</span><span class="token interpolation"><span class="token punctuation">{</span>user<span class="token punctuation">[</span><span class="token string">'account'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">==="</span></span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> retry <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 重试三次</span>
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
            log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"---第</span><span class="token interpolation"><span class="token punctuation">{</span>retry<span class="token punctuation">}</span></span><span class="token string">次尝试---"</span></span><span class="token punctuation">)</span>
            status<span class="token punctuation">,</span> text <span class="token operator">=</span> report_by_dict<span class="token punctuation">(</span>user<span class="token punctuation">)</span>
            <span class="token keyword">if</span> status<span class="token punctuation">:</span>
                message <span class="token operator">+=</span> text <span class="token operator">+</span> <span class="token string">"\n"</span>
                <span class="token keyword">break</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>  <span class="token comment"># 若三次都失败</span>
            message <span class="token operator">+=</span> text <span class="token operator">+</span> <span class="token string">"\n"</span>
    log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"=======消息推送======="</span><span class="token punctuation">)</span>
    log<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string">"待推送消息:\n"</span> <span class="token operator">+</span> message<span class="token punctuation">)</span>
    msg<span class="token punctuation">(</span>message<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="源代码"><a href="#源代码" class="headerlink" title="源代码"></a>源代码</h3><h5 id="whut-py"><a href="#whut-py" class="headerlink" title="whut.py"></a>whut.py</h5><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> index <span class="token keyword">import</span> msg<span class="token punctuation">,</span> report_by_dict
<span class="token keyword">from</span> index <span class="token keyword">import</span> log
<span class="token keyword">import</span> time

data_student<span class="token operator">=</span><span class="token punctuation">[</span>
<span class="token punctuation">{</span><span class="token string">'account'</span><span class="token punctuation">:</span> <span class="token string">'01220xxxxx'</span><span class="token punctuation">,</span>
 <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'xxxxxx'</span><span class="token punctuation">,</span>
 <span class="token string">'province'</span><span class="token punctuation">:</span> <span class="token string">'湖北省'</span><span class="token punctuation">,</span>
 <span class="token string">'city'</span><span class="token punctuation">:</span> <span class="token string">'武汉市'</span><span class="token punctuation">,</span>
 <span class="token string">'county'</span><span class="token punctuation">:</span> <span class="token string">'洪山区'</span><span class="token punctuation">,</span>
 <span class="token string">'street'</span><span class="token punctuation">:</span> <span class="token string">'岭南路'</span><span class="token punctuation">,</span>
 <span class="token string">'is_inschool'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
 <span class="token string">'is_leacecity'</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">,</span>
 <span class="token string">'temperature'</span><span class="token punctuation">:</span> <span class="token string">'36.5°C~36.9°C'</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"======程序启动======="</span><span class="token punctuation">)</span>
    message <span class="token operator">=</span> <span class="token string">"[健康填报-自动反馈]\n"</span>
    <span class="token keyword">for</span> user <span class="token keyword">in</span> data_student<span class="token punctuation">:</span>
        text <span class="token operator">=</span> <span class="token string">""</span>
        log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"===</span><span class="token interpolation"><span class="token punctuation">{</span>user<span class="token punctuation">[</span><span class="token string">'account'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">==="</span></span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> retry <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 重试三次</span>
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
            log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"---第</span><span class="token interpolation"><span class="token punctuation">{</span>retry<span class="token punctuation">}</span></span><span class="token string">次尝试---"</span></span><span class="token punctuation">)</span>
            status<span class="token punctuation">,</span> text <span class="token operator">=</span> report_by_dict<span class="token punctuation">(</span>user<span class="token punctuation">)</span>
            <span class="token keyword">if</span> status<span class="token punctuation">:</span>
                message <span class="token operator">+=</span> text <span class="token operator">+</span> <span class="token string">"\n"</span>
                <span class="token keyword">break</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>  <span class="token comment"># 若三次都失败</span>
            message <span class="token operator">+=</span> text <span class="token operator">+</span> <span class="token string">"\n"</span>
    log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"=======消息推送======="</span><span class="token punctuation">)</span>
    log<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string">"待推送消息:\n"</span> <span class="token operator">+</span> message<span class="token punctuation">)</span>
    msg<span class="token punctuation">(</span>message<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="idnex-py"><a href="#idnex-py" class="headerlink" title="idnex.py"></a>idnex.py</h5><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> logging
<span class="token keyword">import</span> json
<span class="token keyword">import</span> base64
<span class="token keyword">import</span> random
<span class="token keyword">import</span> requests

reported<span class="token operator">=</span><span class="token boolean">False</span>	<span class="token comment">#全局变量，防止重复报送</span>

log <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span><span class="token string">"log.txt"</span><span class="token punctuation">)</span>
log<span class="token punctuation">.</span>setLevel<span class="token punctuation">(</span>logging<span class="token punctuation">.</span>DEBUG<span class="token punctuation">)</span>
shandler <span class="token operator">=</span> logging<span class="token punctuation">.</span>StreamHandler<span class="token punctuation">(</span><span class="token punctuation">)</span>
shandler<span class="token punctuation">.</span>setFormatter<span class="token punctuation">(</span>logging<span class="token punctuation">.</span>Formatter<span class="token punctuation">(</span><span class="token string">"[%(levelname)s] %(message)s"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
shandler<span class="token punctuation">.</span>setLevel<span class="token punctuation">(</span>logging<span class="token punctuation">.</span>INFO<span class="token punctuation">)</span>
fhandler <span class="token operator">=</span> logging<span class="token punctuation">.</span>FileHandler<span class="token punctuation">(</span>filename<span class="token operator">=</span><span class="token string">"log.txt"</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">"w"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span>
fhandler<span class="token punctuation">.</span>setFormatter<span class="token punctuation">(</span>logging<span class="token punctuation">.</span>Formatter<span class="token punctuation">(</span><span class="token string">"&lt;%(asctime)s&gt; [%(levelname)s] %(message)s"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
fhandler<span class="token punctuation">.</span>setLevel<span class="token punctuation">(</span>logging<span class="token punctuation">.</span>DEBUG<span class="token punctuation">)</span>
log<span class="token punctuation">.</span>addHandler<span class="token punctuation">(</span>shandler<span class="token punctuation">)</span>
log<span class="token punctuation">.</span>addHandler<span class="token punctuation">(</span>fhandler<span class="token punctuation">)</span>

conf_notification <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">"cqhttp"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">"enable"</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
        <span class="token string">"api"</span><span class="token punctuation">:</span> <span class="token string">"http://youripaddress:5700/send_group_msg"</span><span class="token punctuation">,</span>
        <span class="token string">"uid"</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
        <span class="token string">"gid"</span><span class="token punctuation">:</span> <span class="token string">"xxxxxxx"</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

ua_list <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">"Mozilla/5.0 (Linux; U; Android 7.1.2; zh-cn; MI 6 Build/NXTHUAWEI) AppleWebKit/537.36 (KHTML, like Gecko)Version/4.0 MQQBrowser/9.9 Mobile Safari/537.36"</span><span class="token punctuation">,</span>
    <span class="token string">"Mozilla/5.0 (iPhone; CPU iPhone OS 9_3_5 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Mobile/13G36 baiduboxapp/0_01.5.2.8_enohpi_6311_046/5.3.9_1C2%8enohPi/1099a/7D4BD508A31C4692ACC31489A6AA6FAA3D5694CC7OCARCEMSHG/1"</span><span class="token punctuation">,</span>
    <span class="token string">"Mozilla/5.0 (Linux; U; Android 4.4.4; en-us; vivo X5Max Build/KTU84P) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 UCBrowser/1.0.0.100 U3/0.8.0 Mobile Safari/534.30 AliApp(TB/6.5.0) WindVane/8.0.0 1080X1920 GCanvas/1.4.2.21"</span><span class="token punctuation">,</span>
    <span class="token string">"Mozilla/5.0 (iPhone; CPU iPhone OS 10_2 like Mac OS X) AppleWebKit/602.3.12 (KHTML, like Gecko) Mobile/14C92 baiduboxapp/0_01.5.2.8_enohpi_8022_2421/2.01_2C2%8enohPi/1099a/05D5623EBB692D46C9C9659B23D68FBD5C7FEB228ORMNJBQOHM/1"</span><span class="token punctuation">,</span>
    <span class="token string">"Mozilla/5.0 (Linux; Android 8.0.0; BKL-AL00 Build/HUAWEIBKL-AL00; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/76.0.3809.89 Mobile Safari/537.36 T7/11.19 SP-engine/2.15.0 baiduboxapp/11.19.5.10 (Baidu; P1 8.0.0)"</span>
<span class="token punctuation">]</span>

headers <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">"Host"</span><span class="token punctuation">:</span> <span class="token string">"zhxg.whut.edu.cn"</span><span class="token punctuation">,</span>
    <span class="token string">"Connection"</span><span class="token punctuation">:</span> <span class="token string">"keep-alive"</span><span class="token punctuation">,</span>
    <span class="token comment"># "Content-Length": "",</span>
    <span class="token comment"># "User-Agent": "",</span>
    <span class="token string">"X-Tag"</span><span class="token punctuation">:</span> <span class="token string">"flyio"</span><span class="token punctuation">,</span>
    <span class="token string">"content-type"</span><span class="token punctuation">:</span> <span class="token string">"application/json"</span><span class="token punctuation">,</span>
    <span class="token string">"encode"</span><span class="token punctuation">:</span> <span class="token string">"true"</span><span class="token punctuation">,</span>
    <span class="token string">"Referer"</span><span class="token punctuation">:</span> <span class="token string">"https://servicewechat.com/wxa0738e54aae84423/21/page-frame.html"</span><span class="token punctuation">,</span>
    <span class="token string">"Accept-Encoding"</span><span class="token punctuation">:</span> <span class="token string">"gzip, deflate, br"</span>
<span class="token punctuation">}</span>

error_log <span class="token operator">=</span> <span class="token string">""</span>

<span class="token keyword">def</span> <span class="token function">check_bind</span><span class="token punctuation">(</span>is_graduate<span class="token punctuation">:</span> <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> error_log
    log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"[1] 正在创建会话"</span><span class="token punctuation">)</span>
    <span class="token comment"># 设置header</span>
	url <span class="token operator">=</span> <span class="token string">"https://zhxg.whut.edu.cn/yqtjwx/api/login/checkBind"</span>
    headers<span class="token punctuation">[</span><span class="token string">"User-Agent"</span><span class="token punctuation">]</span> <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>ua_list<span class="token punctuation">)</span>
    log<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"设置header完成: </span><span class="token interpolation"><span class="token punctuation">{</span>headers<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> dict_to_base64_bin<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"sn"</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token string">"idCard"</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    respounce <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>
    log<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"请求发送完成，收到响应: </span><span class="token interpolation"><span class="token punctuation">{</span>respounce<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> respounce<span class="token punctuation">[</span><span class="token string">"status"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        resp_data <span class="token operator">=</span> base64_str_to_dict<span class="token punctuation">(</span>respounce<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        log<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"响应data解码: </span><span class="token interpolation"><span class="token punctuation">{</span>resp_data<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        headers<span class="token punctuation">[</span><span class="token string">"Cookie"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"JSESSIONID=</span><span class="token interpolation"><span class="token punctuation">{</span>resp_data<span class="token punctuation">[</span><span class="token string">'sessionId'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>  <span class="token comment"># 写入Cookie</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        error_log <span class="token operator">+=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>respounce<span class="token punctuation">)</span>
        log<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">"[X] 创建会话出现错误，详情见log.txt"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>

<span class="token keyword">def</span> <span class="token function">bind_user_info</span><span class="token punctuation">(</span>account<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> password<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> is_graduate<span class="token punctuation">:</span> <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> error_log
    log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"[2] 正在绑定身份"</span><span class="token punctuation">)</span>
	url <span class="token operator">=</span> <span class="token string">"https://zhxg.whut.edu.cn/yqtjwx/api/login/bindUserInfo"</span>
    data <span class="token operator">=</span> dict_to_base64_bin<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"sn"</span><span class="token punctuation">:</span> account<span class="token punctuation">,</span> <span class="token string">"idCard"</span><span class="token punctuation">:</span> password<span class="token punctuation">}</span><span class="token punctuation">)</span>
    respounce <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>
    log<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"请求发送完成，收到响应: </span><span class="token interpolation"><span class="token punctuation">{</span>respounce<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> respounce<span class="token punctuation">[</span><span class="token string">"status"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        resp_data <span class="token operator">=</span> base64_str_to_dict<span class="token punctuation">(</span>respounce<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        log<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"响应data解码: </span><span class="token interpolation"><span class="token punctuation">{</span>resp_data<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        error_log <span class="token operator">+=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>respounce<span class="token punctuation">)</span>
        log<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">"[X] 绑定身份出现错误，详情见log.txt"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>

    
<span class="token keyword">def</span> <span class="token function">monitor_register</span><span class="token punctuation">(</span>is_graduate<span class="token punctuation">:</span> <span class="token builtin">bool</span><span class="token punctuation">,</span> province<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> city<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> county<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> street<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span>is_inschool<span class="token punctuation">:</span> <span class="token builtin">bool</span><span class="token punctuation">,</span> is_leavecity<span class="token punctuation">:</span> <span class="token builtin">bool</span><span class="token punctuation">,</span> temperature<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> error_log
    log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"[3] 正在填报操作"</span><span class="token punctuation">)</span>
    address <span class="token operator">=</span> province <span class="token operator">+</span> city <span class="token operator">+</span> county <span class="token operator">+</span> street
	url <span class="token operator">=</span> <span class="token string">"https://zhxg.whut.edu.cn/yqtjwx/./monitorRegister"</span>
    dict_data <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">"diagnosisName"</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
        <span class="token string">"relationWithOwn"</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
        <span class="token string">"currentAddress"</span><span class="token punctuation">:</span> address<span class="token punctuation">,</span>
        <span class="token string">"remark"</span><span class="token punctuation">:</span> <span class="token string">"无"</span><span class="token punctuation">,</span>
        <span class="token string">"healthInfo"</span><span class="token punctuation">:</span> <span class="token string">"正常"</span><span class="token punctuation">,</span>
        <span class="token string">"isDiagnosis"</span><span class="token punctuation">:</span> <span class="token string">"0"</span><span class="token punctuation">,</span>
        <span class="token string">"isFever"</span><span class="token punctuation">:</span> <span class="token string">"0"</span><span class="token punctuation">,</span>
        <span class="token string">"isInSchool"</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>is_inschool<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">"isLeaveChengdu"</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>is_leavecity<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">"isSymptom"</span><span class="token punctuation">:</span> <span class="token string">"0"</span><span class="token punctuation">,</span>
        <span class="token string">"temperature"</span><span class="token punctuation">:</span> temperature<span class="token punctuation">,</span>
        <span class="token string">"province"</span><span class="token punctuation">:</span> province<span class="token punctuation">,</span>
        <span class="token string">"city"</span><span class="token punctuation">:</span> city<span class="token punctuation">,</span>
        <span class="token string">"county"</span><span class="token punctuation">:</span> county
    <span class="token punctuation">}</span>
    log<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"填报数据生成完成: </span><span class="token interpolation"><span class="token punctuation">{</span>dict_data<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> dict_to_base64_bin<span class="token punctuation">(</span>dict_data<span class="token punctuation">)</span>
    respounce <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>
    log<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"请求发送完成，收到响应: </span><span class="token interpolation"><span class="token punctuation">{</span>respounce<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> respounce<span class="token punctuation">[</span><span class="token string">"status"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        resp_data <span class="token operator">=</span> base64_str_to_dict<span class="token punctuation">(</span>respounce<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        log<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"响应data解码: </span><span class="token interpolation"><span class="token punctuation">{</span>resp_data<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> respounce<span class="token punctuation">[</span><span class="token string">"message"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'今日已填报'</span><span class="token punctuation">:</span>
            <span class="token keyword">global</span> reported
            reported<span class="token operator">=</span> <span class="token boolean">True</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            error_log <span class="token operator">+=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>respounce<span class="token punctuation">)</span>
            log<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">"[X] 填报操作出现错误，详情见log.txt"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>


<span class="token keyword">def</span> <span class="token function">cancel_bind</span><span class="token punctuation">(</span>is_graduate<span class="token punctuation">:</span> <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> error_log
    log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"[4] 正在解绑身份"</span><span class="token punctuation">)</span>
	url <span class="token operator">=</span> <span class="token string">"https://zhxg.whut.edu.cn/yqtjwx/api/login/cancelBind"</span>
    respounce <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span><span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>
    log<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"请求发送完成，收到响应: </span><span class="token interpolation"><span class="token punctuation">{</span>respounce<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> respounce<span class="token punctuation">[</span><span class="token string">"status"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        resp_data <span class="token operator">=</span> base64_str_to_dict<span class="token punctuation">(</span>respounce<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        log<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"响应data解码: </span><span class="token interpolation"><span class="token punctuation">{</span>resp_data<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        error_log <span class="token operator">+=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>respounce<span class="token punctuation">)</span>
        log<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">"[X] 解绑身份出现错误，详情见log.txt"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>

<span class="token keyword">def</span> <span class="token function">dict_to_base64_bin</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span> <span class="token builtin">dict</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bin</span><span class="token punctuation">:</span>
    string <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    binary <span class="token operator">=</span> string<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>
    base64_binary <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>binary<span class="token punctuation">)</span>
    <span class="token keyword">return</span> base64_binary

<span class="token keyword">def</span> <span class="token function">base64_str_to_dict</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">dict</span><span class="token punctuation">:</span>
    string_binary <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    string <span class="token operator">=</span> string_binary<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>
    dictionary <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>string<span class="token punctuation">)</span>
    <span class="token keyword">return</span> dictionary

<span class="token keyword">def</span> <span class="token function">report</span><span class="token punctuation">(</span>account<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> password<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> is_graduate<span class="token punctuation">:</span> <span class="token builtin">bool</span><span class="token punctuation">,</span>
           province<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> city<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> county<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> street<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span>
           is_inschool<span class="token punctuation">:</span> <span class="token builtin">bool</span><span class="token punctuation">,</span> is_leacecity<span class="token punctuation">:</span> <span class="token builtin">bool</span><span class="token punctuation">,</span> temperature<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">tuple</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> error_log
    log<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"开始填报: </span><span class="token interpolation"><span class="token punctuation">{</span>account<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    status <span class="token operator">=</span> <span class="token boolean">True</span>  <span class="token comment"># 填报状态</span>
    headers<span class="token punctuation">[</span><span class="token string">"Cookie"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">""</span>  <span class="token comment"># 重置headers</span>
    error_log <span class="token operator">=</span> <span class="token string">""</span>  <span class="token comment"># 重置错误日志</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token punctuation">(</span>check_bind<span class="token punctuation">(</span>is_graduate<span class="token punctuation">)</span> <span class="token keyword">and</span>
                bind_user_info<span class="token punctuation">(</span>account<span class="token punctuation">,</span> password<span class="token punctuation">,</span> is_graduate<span class="token punctuation">)</span> <span class="token keyword">and</span>
                monitor_register<span class="token punctuation">(</span>is_graduate<span class="token punctuation">,</span> province<span class="token punctuation">,</span> city<span class="token punctuation">,</span> county<span class="token punctuation">,</span> street<span class="token punctuation">,</span> is_inschool<span class="token punctuation">,</span> is_leacecity<span class="token punctuation">,</span> temperature<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            status <span class="token operator">=</span> <span class="token boolean">False</span>
    <span class="token keyword">finally</span><span class="token punctuation">:</span>
        status <span class="token operator">&amp;</span><span class="token operator">=</span> cancel_bind<span class="token punctuation">(</span>is_graduate<span class="token punctuation">)</span>
    <span class="token keyword">if</span> status<span class="token punctuation">:</span>
        <span class="token keyword">if</span> reported<span class="token punctuation">:</span>
            log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"------今日已填报，别操心了------"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f" </span><span class="token interpolation"><span class="token punctuation">{</span>account<span class="token punctuation">}</span></span><span class="token string"> 今日已填报！"</span></span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>account<span class="token punctuation">}</span></span><span class="token string">填报成功"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f" </span><span class="token interpolation"><span class="token punctuation">{</span>account<span class="token punctuation">}</span></span><span class="token string"> 填报成功！"</span></span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        log<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>account<span class="token punctuation">}</span></span><span class="token string">填报失败"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f" </span><span class="token interpolation"><span class="token punctuation">{</span>account<span class="token punctuation">}</span></span><span class="token string"> 填报失败！\n"</span></span> <span class="token operator">+</span> error_log


<span class="token keyword">def</span> <span class="token function">report_by_dict</span><span class="token punctuation">(</span>user<span class="token punctuation">:</span> <span class="token builtin">dict</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">tuple</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> report<span class="token punctuation">(</span>user<span class="token punctuation">[</span><span class="token string">"account"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> user<span class="token punctuation">[</span><span class="token string">"password"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> user<span class="token punctuation">[</span><span class="token string">"is_graduate"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                  user<span class="token punctuation">[</span><span class="token string">"province"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> user<span class="token punctuation">[</span><span class="token string">"city"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> user<span class="token punctuation">[</span><span class="token string">"county"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> user<span class="token punctuation">[</span><span class="token string">"street"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                  user<span class="token punctuation">[</span><span class="token string">"is_inschool"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> user<span class="token punctuation">[</span><span class="token string">"is_leacecity"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> user<span class="token punctuation">[</span><span class="token string">"temperature"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

api <span class="token operator">=</span> conf_notification<span class="token punctuation">[</span><span class="token string">"cqhttp"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"api"</span><span class="token punctuation">]</span>  <span class="token comment"># cqhttp http API 地址</span>
uid <span class="token operator">=</span> conf_notification<span class="token punctuation">[</span><span class="token string">"cqhttp"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"uid"</span><span class="token punctuation">]</span>  <span class="token comment"># 收信QQ号，不填则不发送</span>
gid <span class="token operator">=</span> conf_notification<span class="token punctuation">[</span><span class="token string">"cqhttp"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"gid"</span><span class="token punctuation">]</span>  <span class="token comment"># 收信群号，不填则不发送</span>


<span class="token keyword">def</span> <span class="token function">msg</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        send_cqhttp<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
        log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"成功发送cqhttp消息"</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
        log<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">"发送cqhttp消息失败"</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">send_cqhttp</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
    data_user <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">"user_id"</span><span class="token punctuation">:</span> uid<span class="token punctuation">,</span>
        <span class="token string">"message"</span><span class="token punctuation">:</span> text
    <span class="token punctuation">}</span>
    data_group <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">"group_id"</span><span class="token punctuation">:</span> gid<span class="token punctuation">,</span>
        <span class="token string">"message"</span><span class="token punctuation">:</span> text
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> data_user<span class="token punctuation">[</span><span class="token string">"user_id"</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">""</span><span class="token punctuation">:</span>
        requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>api<span class="token punctuation">,</span> params<span class="token operator">=</span>data_user<span class="token punctuation">)</span>
    <span class="token keyword">if</span> data_group<span class="token punctuation">[</span><span class="token string">"group_id"</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">""</span><span class="token punctuation">:</span>
        requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'http://127.0.0.1:5700/send_group_msg'</span><span class="token punctuation">,</span> params<span class="token operator">=</span>data_group<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="定时报送"><a href="#定时报送" class="headerlink" title="定时报送"></a>定时报送</h3><p>如果你没有云服务器，也可以部署到本地（即自己的电脑）。</p>
<p>需要保证在你设定的报送时间内电脑处于开机状态。</p>
<p>部署教程自行百度或者参考底部相关链接，以下以自己Linux云服务器为例进行演示：</p>
<p>1.首先通过Xftp上传python文件到服务器</p>
<p>2.通过Xshell远程连接服务器</p>
<p>su 输入密码 进入root用户</p>
<p>创建 screen 终端，执行screen -S whut，防止ssh连接断开后定时任务无法执行</p>
<pre class="line-numbers language-none"><code class="language-none">#  新建screen
screen -S your_screen_name
# 进入screen
screen -r your_screen_name
Ctrl+D  # 在当前screen下，输入Ctrl+D，删除该screen
Ctrl+A，Ctrl+D  # 在当前screen下，输入先后Ctrl+A，Ctrl+D，退出该screen
#  显示screen list
screen -ls
# 连接状态为【Attached】的screen
screen -D  -r your_screen_name  # 解释：-D -r 先踢掉前一用户，再登陆
# 判断当前是否在screen中断下,Ubuntu系统,可以这样:
sudo vim /etc/screenrc
# 文件末尾追加一行即可允许设置screen标题
caption always "%{.bW}%-w%{.rW}%n %t%{-}%+w %=%H %Y/%m/%d "
# 删除指定screen, your_screen_name为待删除的screen name
screen -S your_screen_name -X quit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>创建定时任务</p>
<p>执行crontab -e进入定时任务编写界面，按i进入输入状态</p>
<p>输入下面代码后，按Esc输入：wq回车保存退出</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token number">30</span> <span class="token number">7</span> <span class="token operator">*</span> <span class="token operator">*</span> <span class="token operator">*</span> python3 <span class="token operator">/</span>home<span class="token operator">/</span>liux1<span class="token operator">/</span>wut<span class="token operator">/</span>whut<span class="token punctuation">.</span>py<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>crontab时间计算表：<a href="https://tool.lu/crontab/">https://tool.lu/crontab/</a></p>
<p>crontab参考：<a href="https://www.runoob.com/linux/linux-comm-crontab.html">https://www.runoob.com/linux/linux-comm-crontab.html</a></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">例子：
    <span class="token comment"># 每月的最后1天</span>
    <span class="token number">0</span> <span class="token number">0</span> L <span class="token operator">*</span> <span class="token operator">*</span> <span class="token operator">*</span>

    说明：
    Linux
    <span class="token operator">*</span>    <span class="token operator">*</span>    <span class="token operator">*</span>    <span class="token operator">*</span>    <span class="token operator">*</span>
    <span class="token operator">-</span>    <span class="token operator">-</span>    <span class="token operator">-</span>    <span class="token operator">-</span>    <span class="token operator">-</span>
    <span class="token operator">|</span>    <span class="token operator">|</span>    <span class="token operator">|</span>    <span class="token operator">|</span>    <span class="token operator">|</span>
    <span class="token operator">|</span>    <span class="token operator">|</span>    <span class="token operator">|</span>    <span class="token operator">|</span>    <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span> day of week <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">-</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>Sunday<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">or</span> <span class="token number">7</span><span class="token punctuation">)</span> OR sun<span class="token punctuation">,</span>mon<span class="token punctuation">,</span>tue<span class="token punctuation">,</span>wed<span class="token punctuation">,</span>thu<span class="token punctuation">,</span>fri<span class="token punctuation">,</span>sat
    <span class="token operator">|</span>    <span class="token operator">|</span>    <span class="token operator">|</span>    <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span> month <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> <span class="token number">12</span><span class="token punctuation">)</span> OR jan<span class="token punctuation">,</span>feb<span class="token punctuation">,</span>mar<span class="token punctuation">,</span>apr <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token operator">|</span>    <span class="token operator">|</span>    <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span> day of month <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> <span class="token number">31</span><span class="token punctuation">)</span>
    <span class="token operator">|</span>    <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span> hour <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">-</span> <span class="token number">23</span><span class="token punctuation">)</span>
    <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span> minute <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">-</span> <span class="token number">59</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="自动反馈"><a href="#自动反馈" class="headerlink" title="自动反馈"></a>自动反馈</h3><p>参考<a href="https://docs.go-cqhttp.org/">https://docs.go-cqhttp.org/</a></p>
<h3 id="效果演示"><a href="#效果演示" class="headerlink" title="效果演示"></a>效果演示</h3><p><img src="https://img.gejiba.com/images/bfc0e451f54c95f97a344476be619782.png" alt="bfc0e451f54c95f97a344476be619782.png"></p>
<h3 id="问题反馈"><a href="#问题反馈" class="headerlink" title="问题反馈"></a>问题反馈</h3><p>如果你使用的时候出现了异常情况，欢迎在下方评论并附上错误详情，或发邮件联系我。</p>
<p>程序日志为同目录的 <code>log.txt</code> 文件。注意，日志中含有敏感隐私信息，不建议直接公开。</p>
<p>详细日志中的 <code>message</code> 条目和 <code>Python Traceback</code> 信息可公开分享。</p>
<h3 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h3><p><a href="https://docs.go-cqhttp.org/">https://docs.go-cqhttp.org/</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/430602325">https://zhuanlan.zhihu.com/p/430602325</a></p>
<h3 id="特别鸣谢"><a href="#特别鸣谢" class="headerlink" title="特别鸣谢"></a>特别鸣谢</h3><p>本文参考github等博客论坛多个项目，感谢ChrisKimZHT大佬的开源精神！</p>
<p>感谢Linux one IBM云服务器4月免费体验，感谢cqhttp开发者！</p>
<p>over.</p>

        
    </div>
    </div>

    <div class="article-badge">
        
        
    </div>

</div>

<footer class="article-footer">
    <div class="article-more-info">
    <div class="article-date">
  <time datetime="2022-08-30T09:09:47.000Z" itemprop="datePublished">2022-08-30</time>
</div>
    
        <div class="article-category">
        <a class="article-category-link" href="/categories/%E6%87%92%E4%BA%BA%E5%BF%85%E5%A4%87/">懒人必备</a>
        </div>
    
    
        <div class="article-tag">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/" rel="tag">Python</a></li></ul>
        </div>
    
    </div>
</footer>

</article>

    
  
    
      <article
id="post-靶场日记—Uploadlabs"
class="article article-type-post"
>



<div class="article-inner">
    

    <div class="article-body">
    <header class="article-title">
        <a href="/2022/uploadlabs/">靶场日记-Uploadlabs</a>
    </header>
    <div class="article-entry post-inner-html">
        
        <h3 id="Pass-01-JS前端验证"><a href="#Pass-01-JS前端验证" class="headerlink" title="Pass-01 JS前端验证"></a>Pass-01 JS前端验证</h3><p>漏洞描述：利用前端js对上传文件后缀进行校验，后端没有进行检测</p>
<p>利用方法：</p>
<p>1.浏览器F12-&gt;F1 禁用js</p>
<p>2.bp抓包 先上传白名单后缀文件 修改后缀后放包</p>
<h3 id="Pass-02-MIME验证"><a href="#Pass-02-MIME验证" class="headerlink" title="Pass-02 MIME验证"></a>Pass-02 MIME验证</h3><p>漏洞描述：只检测数据包中Content-Type字段导致的漏洞</p>
<p>后端利用PHP的全局数组$_FILES()获取上传文件类型Type</p>
<p>利用方法：</p>
<p>修改content-type字段的值为白名单</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">常用content-type字段：
image/jpeg	jpg图片格式
image/png	png图片格式
image/gif	gif图片格式
text/palin	纯文本格式
text/xml	XML格式
text/html	HTML格式<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Pass-03-文件名后缀校验（黑名单绕过）"><a href="#Pass-03-文件名后缀校验（黑名单绕过）" class="headerlink" title="Pass-03 文件名后缀校验（黑名单绕过）"></a>Pass-03 文件名后缀校验（黑名单绕过）</h3><p>漏洞描述：使用黑名单的方式限制文件上传类型，后端利用$_FILES()和strrchr()获取文件名后缀</p>
<p>被限制文件类型：.asp .aspx .php .jsp</p>
<p>利用方法：</p>
<p>因为是利用黑名单来限制文件上传类型，找漏网之鱼绕过</p>
<p>例如：</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">特殊文件名绕过： .php3 .php4 .php5 .phtml .phtm .phps .phpt .php345<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="Pass-04-文件名后缀校验（配置文件解析控制）"><a href="#Pass-04-文件名后缀校验（配置文件解析控制）" class="headerlink" title="Pass-04 文件名后缀校验（配置文件解析控制）"></a>Pass-04 文件名后缀校验（配置文件解析控制）</h3><p>漏洞描述：</p>
<p>依然是使用黑名单限制，但几乎过滤了所有脚本文件的后缀名，但可以允许上传.htaccess文件。</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">htaccess文件是Apache服务器中的一个配置文件，它负责相关目录下的网页配置。
通过htaccess文件，可以实现：
1.网页301重定向
2.自定义404错误页面
3.改变文件扩展名
4.允许/阻止特定的用户或者目录的访问
5.禁止目录列表
6.配置默认文档等功能<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>利用方法：</p>
<p>上传.htaccess解析文件，利用其配置，将白名单文件的类型解析成php文件类型。</p>
<p>上传.htaccess文件 内容如下：(将服务器上的test.jpg文件解析成php文件，这里文件可以自由配置)</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>FilesMatch</span> <span class="token attr-name">"test.jpg"</span><span class="token punctuation">&gt;</span></span>         
SetHandler application/x-httpd-php
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>FilesMatch</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>再上传一个一句话木马，文件名为test.jpg，依旧访问test.jpg，但其会以php形式显示</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id="Pass-05-文件名后缀校验（配置文件解析控制）"><a href="#Pass-05-文件名后缀校验（配置文件解析控制）" class="headerlink" title="Pass-05 文件名后缀校验（配置文件解析控制）"></a>Pass-05 文件名后缀校验（配置文件解析控制）</h3><p>漏洞描述：过滤了.htaccess</p>
<p>利用方法：</p>
<p>使用大小写绕过.htaccess</p>
<p>利用.user.ini配置文件</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">.user.ini。它比.htaccess用的更广泛，不管服务器是nginx/apache/IIS，当使用CGI／FastCGI来解析php时，php会优先搜索目录下所有的.ini文件，并应用其中的配置。类似于apache的.htaccess，但语法与.htacces不同，语法跟php.ini一致。<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>上传文件 .user.ini,内容为：</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">auto_prepend_file=test.jpg<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>再上传一个内容为php一句话脚本，命名为test.jpg。</p>
<p>.user.ini文件作用：所有的php文件都自动包含test.jpg文件。.user.ini相当于一个用户自定义的php.ini。</p>
<h3 id="Pass-06-文件名后缀校验（大小写绕过）"><a href="#Pass-06-文件名后缀校验（大小写绕过）" class="headerlink" title="Pass-06 文件名后缀校验（大小写绕过）"></a>Pass-06 文件名后缀校验（大小写绕过）</h3><p>漏洞描述：</p>
<p>对于文件名后缀的校验时，没有进行通用的大小转换后的校验-&gt;strtolower()</p>
<p>大小写绕过原理：</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">Windows系统下，对于文件名中的大小写不敏感。例如：test.php和TeSt.PHP是一样的。
Linux系统下，对于文件名中的大小写敏感。例如：test.php和 TesT.php就是不一样的。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>利用方法：文件后缀为.PHP</p>
<h3 id="Pass-07-文件名后缀校验（空格绕过）"><a href="#Pass-07-文件名后缀校验（空格绕过）" class="headerlink" title="Pass-07 文件名后缀校验（空格绕过）"></a>Pass-07 文件名后缀校验（空格绕过）</h3><p>漏洞描述：</p>
<p>对上传的文件名未做去空格的操作-&gt;trim()函数</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">Windows系统下，对于文件名中空格会被作为空处理，程序中的检测代码却不能自动删除空格。从而绕过黑名单。
即使用".php "不会被黑名单“.php”识别出来<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>利用方法：burp抓包，修改对应的文件名 添加空格。</p>
<h3 id="Pass-08-文件名后缀校验（点号绕过）"><a href="#Pass-08-文件名后缀校验（点号绕过）" class="headerlink" title="Pass-08 文件名后缀校验（点号绕过）"></a>Pass-08 文件名后缀校验（点号绕过）</h3><p>漏洞描述：</p>
<p>对上传的文件后缀名未做去点.的操作 -&gt;strrchr($file_name, ‘.’)</p>
<pre><code>利用Windows系统下，文件后缀名最后一个点会被自动去除的特性。
即使用".php."不会被黑名单“.php”识别出来
</code></pre>
<p>利用方法：文件后缀名为 .php.</p>
<h3 id="Pass-09-文件名后缀校验（-DATA绕过）"><a href="#Pass-09-文件名后缀校验（-DATA绕过）" class="headerlink" title="Pass-09 文件名后缀校验（::$DATA绕过）"></a>Pass-09 文件名后缀校验（::$DATA绕过）</h3><p>漏洞描述：</p>
<p>对上传的文件后缀名未做去除::$DATA处理</p>
<pre><code>Windows系统下，如果上传的文件名为test.php::$DATA会在服务器上生成一个test.php的文件，其中内容和所上传文件内容相同，并被解析。
</code></pre>
<p>利用方法：</p>
<p>上传带有一句话木马的文件，其文件名为test.php::$DATA</p>
<h3 id="Pass-10-文件名后缀校验（拼接绕过）"><a href="#Pass-10-文件名后缀校验（拼接绕过）" class="headerlink" title="Pass-10 文件名后缀校验（拼接绕过）"></a>Pass-10 文件名后缀校验（拼接绕过）</h3><p>漏洞描述：</p>
<p>将文件名进行过滤操作后，将文件名拼接在路径后面，所以需要绕过前面的<strong>首尾去空以及去点</strong>。</p>
<p>利用方法：</p>
<p>上传文件名为 .php. .(点+php+点+空格+点)</p>
<h3 id="Pass-11-文件名后缀校验（双写绕过）"><a href="#Pass-11-文件名后缀校验（双写绕过）" class="headerlink" title="Pass-11 文件名后缀校验（双写绕过）"></a>Pass-11 文件名后缀校验（双写绕过）</h3><p>漏洞描述：</p>
<p>利用str_ireplace()函数将文件名中符合黑名单的字符串替换成空</p>
<p>利用方式：</p>
<p>利用<strong>双写</strong>黑名单字符，对字符串的一次过滤后拼接出php,文件名.pphphp</p>
<h3 id="Pass-12-白名单校验（GET型0x00截断）"><a href="#Pass-12-白名单校验（GET型0x00截断）" class="headerlink" title="Pass-12 白名单校验（GET型0x00截断）"></a>Pass-12 白名单校验（GET型0x00截断）</h3><p>漏洞描述：</p>
<p>使用<strong>白名单</strong>限制上传文件类型，但上传文件的<strong>存放路径可控</strong></p>
<p>利用方法：</p>
<p>设置上传路径为upload/phpinfo.php%00 </p>
<p>添加phpinfo.php%00内容为了控制路径，上传文件后缀为白名单即可</p>
<p>例:test.jpg，保存后为**/upload/phpinfo.php%00test.jpg**</p>
<p>但服务端读取到**%00**时会自动结束，将文件内容保存至phpinfo.php中</p>
<p>PS:</p>
<p><strong>需要php的版本号低于5.3.29，且magic_quotes_gpc为关闭状态</strong></p>
<h3 id="Pass-13-白名单校验（POST型0x00截断）"><a href="#Pass-13-白名单校验（POST型0x00截断）" class="headerlink" title="Pass-13 白名单校验（POST型0x00截断）"></a>Pass-13 白名单校验（POST型0x00截断）</h3><p>漏洞描述：</p>
<p>使用白名单限制上传文件类型，但上传文件的存放路径可控，但因为是POST型，需要在16进制中修改，因为POST不会像GET那样对%00进行自动解码。</p>
<p><img src="/./%E9%9D%B6%E5%9C%BA%E6%97%A5%E8%AE%B0/P2"></p>
<p><img src="/./%E9%9D%B6%E5%9C%BA%E6%97%A5%E8%AE%B0/P1.jpeg"></p>
<h3 id="Pass-14-文件内容检测（文件头校验）"><a href="#Pass-14-文件内容检测（文件头校验）" class="headerlink" title="Pass-14 文件内容检测（文件头校验）"></a>Pass-14 文件内容检测（文件头校验）</h3><p>漏洞描述：</p>
<p>通过读文件的前2个字节，检测上传文件二进制的头信息，判断文件类型，利用图片马绕过检测。</p>
<p>利用方法：</p>
<p><strong>图片马制作</strong></p>
<p>在cmd里执行 <strong>copy logo.jpg/b+test.php/a test.jpg</strong></p>
<p>logo.jpg为任意图片<br>test.php为我们要插入的木马代码<br>test.jpg为我们要创建的图片马<br>名字可任意</p>
<h3 id="Pass-15-文件内容检测-（getimagesize-校验）"><a href="#Pass-15-文件内容检测-（getimagesize-校验）" class="headerlink" title="Pass-15 文件内容检测 （getimagesize()校验）"></a>Pass-15 文件内容检测 （getimagesize()校验）</h3><p>漏洞描述：</p>
<p>通过getimagesize()获取上传文件信息，图片马绕过</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">getimagesize() 函数用于获取图像大小及相关信息，成功返回一个数组<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="Pass-16-文件内容检测（exif-imagetype-绕过）"><a href="#Pass-16-文件内容检测（exif-imagetype-绕过）" class="headerlink" title="Pass-16 文件内容检测（exif_imagetype()绕过）"></a>Pass-16 文件内容检测（exif_imagetype()绕过）</h3><p>漏洞描述：</p>
<p>利用php内置函数exif_imagetype()获取图片类型（需要开启php_exif模块）</p>
<p>利用方法：<br>(1)图片马</p>
<p>(2)预定义高度宽度：</p>
<p>例 .htaccess文件</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">文件内容
#define width 1337
#define height 1337
文件内容---<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>(3)利用x00x00x8ax39x8ax39文件头</p>
<p>x00x00x8ax30x8ax39是wbmp文件的文件头，但0x00在.htaccess文件中为是注释符，不会影响文件本身。使用十六进制编辑器或者python的bytes字符类型(b’’)来进行添加。</p>
<p>payload:shell = b”\x00\x00\x8a\x39\x8a\x39”+b”00” + ‘文件内容’</p>
<h3 id="Pass-17-文件内容检测（二次渲染）"><a href="#Pass-17-文件内容检测（二次渲染）" class="headerlink" title="Pass-17 文件内容检测（二次渲染）"></a>Pass-17 文件内容检测（二次渲染）</h3><p>漏洞描述：</p>
<p>综合判断了后缀名、content-type，以及利用imagecreatefromgif判断是否为gif图片，并在最后对文件内容进行了二次渲染，修改文件内容</p>
<p>绕过方法：</p>
<p>上传一个GIF图片马，然后将其下载下来，查看其十六进制的文件内容，找到二次渲染后不变的地方，而这个地方就是可以插入一句话的地方</p>
<h3 id="Pass-18-逻辑漏洞（条件竞争）"><a href="#Pass-18-逻辑漏洞（条件竞争）" class="headerlink" title="Pass-18 逻辑漏洞（条件竞争）"></a>Pass-18 逻辑漏洞（条件竞争）</h3><p>漏洞描述：</p>
<p>先将文件上传到服务器，然后通过rename修改名称，再通过unlink删除文件，因此可以通过条件竞争的方式在unlink之前，访问webshell</p>
<p>利用方法：</p>
<p>使用burp或者python脚本对要上传的文件路径进行不断的访问(upload/webshell.php)，上传一个webshell.php，但访问该文件，会在目录下生成一个webshell，文件内容为：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token function">fputs</span><span class="token punctuation">(</span><span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'shell.php'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'&lt;?php @eval($_POST["cmd"]) ?&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>Ps：</p>
<pre><code>(1)不断上传文件，然后去访问

(2)不断访问，然后去上传文件
</code></pre>
<h1 id="Pass-19-逻辑漏洞（条件竞争-图片马）"><a href="#Pass-19-逻辑漏洞（条件竞争-图片马）" class="headerlink" title="Pass-19 逻辑漏洞（条件竞争-图片马）"></a>Pass-19 逻辑漏洞（条件竞争-图片马）</h1><p>漏洞描述：</p>
<p>后缀名做了白名单判断，然后会一步一步检查文件大小、文件是否存在等等，将文件上传后，对文件重新命名，同样存在条件竞争的漏洞。可以不断利用burp发送上传图片马的数据包，由于条件竞争，程序会出现来不及rename的问题，从而上传成功</p>
<p>利用方法：</p>
<p>区别于Pass-18,这里需要使用图片马</p>
<p>Pass-20 逻辑漏洞（小数点绕过）</p>
<p>漏洞描述：</p>
<p>使用pathinfo($file_name,PATHINFO_EXTENSION)的方式检查文件名后缀（从最后一个小数点进行截取），并使用的是黑名单方式。</p>
<p>利用方法：</p>
<p>上传一句话木马，在文件名后缀加一个小数点绕过 phpinfo.php.，上传成功可以直接访问phpinfo.php</p>
<h1 id="Pass-21-逻辑漏洞（数组绕过）"><a href="#Pass-21-逻辑漏洞（数组绕过）" class="headerlink" title="Pass-21 逻辑漏洞（数组绕过）"></a>Pass-21 逻辑漏洞（数组绕过）</h1><p>漏洞描述：</p>
<p>对参数$file进行判断，如果不是，将其修改为数组，但我们提前传入数组时，造成漏洞</p>
<p>利用方法：</p>
<p>数组绕过</p>
<p>防御文件上传</p>
<pre><code>1.检验扩展名是否在范围内

2.图像文件的情况下确认其文件头为图像类型，而不是伪装文件

3.针对上传文件大小进行约定（防止上传大文件进行DDOS攻击）

4.服务器端验证(防止前端绕过)，重新渲染图片b

5.上传的文件重命名，把文件地址隐藏了
</code></pre>

        
    </div>
    </div>

    <div class="article-badge">
        
        
    </div>

</div>

<footer class="article-footer">
    <div class="article-more-info">
    <div class="article-date">
  <time datetime="2022-08-24T03:20:37.000Z" itemprop="datePublished">2022-08-24</time>
</div>
    
        <div class="article-category">
        <a class="article-category-link" href="/categories/%E9%9D%B6%E5%9C%BA%E6%97%A5%E8%AE%B0/">靶场日记</a>
        </div>
    
    
        <div class="article-tag">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/upload/" rel="tag">upload</a></li></ul>
        </div>
    
    </div>
</footer>

</article>

    
  

  
    <nav class="pagination">
        <a class="extend prev" rel="prev" href="/">Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/3/">Next</a>
    </nav>
  
</div>

                </section>
            </section>

            
            <aside class="sidebar sidebar-search-fix">
                

    <div class="search">
    <div class="has-icon-right">
        <input type="text" class="form-input" id="search" placeholder="SEARCH" autocomplete="off">
        <div class="form-icon">
            <ion-icon name="search"></ion-icon>
        </div>
    </div>
    <div class="search-result" id="search-ps"></div>
</div>


<div class="widget" id="widget">
    
      
    
      
  <div class="widget-wrap widget-cate">
    <div class="widget-title"><span>Categories</span></div>
    <div class="widget-inner">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/DataBase/">DataBase</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Math/">Math</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/SRC/">SRC</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Sec/">Sec</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/SecTools/">SecTools</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/WebSec/">WebSec</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Whut/">Whut</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Windows/">Windows</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/XiaoHu-s-Daily/">XiaoHu's Daily</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/languages/">languages</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AD%A6%E4%B9%A0%E6%9C%AD%E8%AE%B0/">学习札记</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/">实验报告</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%87%92%E4%BA%BA%E5%BF%85%E5%A4%87/">懒人必备</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">数据结构</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9D%B6%E5%9C%BA%E6%97%A5%E8%AE%B0/">靶场日记</a></li></ul>
    </div>
  </div>


    
      
  <div class="widget-wrap widget-tags">
    <div class="widget-title"><span>Tags</span></div>
    <div class="widget-inner">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/" rel="tag">C</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/" rel="tag">C++</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SRC/" rel="tag">SRC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sec/" rel="tag">Sec</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tools/" rel="tag">Tools</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Whut/" rel="tag">Whut</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Windows/" rel="tag">Windows</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/XSS/" rel="tag">XSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/daily/" rel="tag">daily</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hacker/" rel="tag">hacker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/markdwon/" rel="tag">markdwon</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/me/" rel="tag">me</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/upload/" rel="tag">upload</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8D%95%E7%89%87%E6%9C%BA/" rel="tag">单片机</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/" rel="tag">数学建模</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="tag">数据结构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%A1%E7%BD%91/" rel="tag">计网</a></li></ul>
    </div>
  </div>


    
      
  <div class="widget-wrap widget-recent-posts">
    <div class="widget-title"><span>Recent Posts</span></div>
    <div class="widget-inner">
      <ul>
        
          <li>
            <a href="/2022/jwtk/">WUT-计算机网络题库难点浅解</a>
          </li>
        
          <li>
            <a href="/2022/software/">WUT-单片机EDA软件工具下载</a>
          </li>
        
          <li>
            <a href="/2022/networking/">WUT-组网技术实验报告</a>
          </li>
        
          <li>
            <a href="/2022/xue-xi-zha-ji-linux-ji-chu-ru-men/">学习札记—Linux基础入门</a>
          </li>
        
          <li>
            <a href="/2022/51dpj/">学习札记——51单片机(C语言版)</a>
          </li>
        
      </ul>
    </div>
  </div>

    
      
  <div class="widget-wrap widget-archive">
    <div class="widget-title"><span>Archive</span></div>
    <div class="widget-inner">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/">2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/">2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/">2019</a></li></ul>
    </div>
  </div>


    
</div>

<div id="backtop"><i class="icon icon-arrow-up"></i></div>
            </aside>
            
        </div>
    </div>

    <footer class="footer">
    <div class="footer-wave">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="#3c4859" fill-opacity="1" d="M0,160L60,181.3C120,203,240,245,360,240C480,235,600,181,720,186.7C840,192,960,256,1080,261.3C1200,267,1320,213,1380,186.7L1440,160L1440,320L1380,320C1320,320,1200,320,1080,320C960,320,840,320,720,320C600,320,480,320,360,320C240,320,120,320,60,320L0,320Z"></path></svg>
    </div>

    <!-- Please do not remove this -->
    <!-- 开源不易，请勿删除 -->
    <div class="footer-wrap">
        <div class="footer-inner"> 
            Kmoon &copy; 2022<br>
            Powered By Hexo · Theme By <a href="https://linhong.me/" target="_blank">Aomori</a> · <a href="https://github.com/lh1me/hexo-theme-aomori" target="_blank">Github</a>
        </div>
    </div>

</footer>

<script type="module" src="https://unpkg.com/ionicons@6.0.2/dist/ionicons/ionicons.esm.js"></script>






<script src="/dist/build.js?1654266144177.js"></script>


<script src="/dist/custom.js?1654266144177.js"></script>



<!-- 百度链接提交 -->
<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        }
        else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>











<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":220,"height":300},"mobile":{"show":true},"log":false,"pluginJsPath":"lib/","pluginRootPath":"live2dw/","tagMode":false});</script></body>

</html>